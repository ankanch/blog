<html>
    <!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	

	<title>Wordpress 添加自定义模板并创建基于bootstrap4的页面 | akakanch</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	<link rel="shortcut icon" href="/favicon.ico">	
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/caomei.css">
	<link rel="stylesheet" href="/css/style.css">
	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

    <body>
        <div class="root">
            <div class='topnavs container fixed-690'>
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            首页
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/categories">
                            分类
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/archives">
                            归档
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/tags">
                            标签
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/about">
                            关于
                        </a>
                    </li>
                    
            </ul>
        </div>
    </nav>
</div>
                <section class="container mainbody fixed-690">
                    <div class="post">
    <div class="post-title">
        <h1>
            Wordpress 添加自定义模板并创建基于bootstrap4的页面 
        </h1>

        
        <div class="post-title-views">
            <span id="busuanzi_container_page_pv">
                本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
            </span>
        </div>
        
    </div>
    <div class="post-content markdown">
        <p>最近我写了一个博客系统（<a href="https://github.com/ankanch/myblog" target="_blank" rel="noopener">myblog</a>），原本打算替换掉wordpress的，但是后面发现wordpress可以自定义模板，故将myblog的部分样式应用到自定义页面模板上，本来以为只需要简单的创建模板，然后导入css和js即可，结果发现导入后界面完全乱了，甚至还影响了属于wordpress的部分（footer和header）。</p>
<p>由于我的myblog需要bootstrap 4的支持，所以需要额外导入bootstrap 4的样式表，但是由于我使用的主题使用了低版本的样式表，如果直接在模板页面导入会照成我导入的覆盖掉主题默认使用的，导致界面混乱。在经过一番搜索后，找到了如下几个解决方案：</p>
<ol>
<li>使用iframe</li>
<li>手动添加 容器ID来限定每个样式的作用域</li>
<li>使用第三方插件如：<a href="https://github.com/thingsinjars/jQuery-Scoped-CSS-plugin" target="_blank" rel="noopener">Simon Madine’s jQuery Scoped CSS plugin</a>.<br>我首先尝试了方法二，写了个python脚本帮助实现，但是对于 @media之类的，就无能为力了，故放弃。</li>
</ol>
<p>然后尝试方法一，有效的方法。如下：</p>
<p>首先我们要创建一个自定义模板，以myblog_theme_page.php为例，其代码如下：</p>
<p>myblog_theme_page.php:</p>
<p><pre class="lang:php decode:true">&lt;?php<br>/<em><br>Template Name: myblog_theme
</em>/<br> get_header(); ?&gt;</pre></p>
<p>&lt;div id=”primary” class=”site-content-fullwidth” style=”background:white;”&gt;<br>  &lt;div id=”content” role=”main” style=”background:white;”&gt;<br>&lt;div id=”myblog_style_page” style=”margin-left:45px;margin-right:45px;”&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;</a> type=’text/css’ /&gt;<br>&lt;script type=’text/javascript’ src=’<a href="http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script">http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script</a>&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;</a> type=’text/css’ /&gt;<br>&lt;div class=”container”&gt;<br>&lt;?php /<em> Start the Loop </em>/ ?&gt;<br>&lt;?php while(have_posts()) : the_post(); ?&gt;<br>&lt;?php the_content();?&gt;<br>&lt;?php endwhile; ?&gt;</p>
<p>&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;iframe id=”result”  frameBorder=”0” style=”overflow:hidden;”&gt;<br>&lt;/iframe&gt;<br>  &lt;/div&gt;&lt;!– #content –&gt;<br>&lt;/div&gt;&lt;!– #primary –&gt;<br>&lt;script&gt;<br>  function resizeIframe(obj) {<br>    obj.style.height = obj.contentWindow.document.body.scrollHeight + ‘px’;<br>  }<br>    $(document).ready(function () {<br>        var iframe = document.getElementById(‘result’),<br>        iframedoc = iframe.contentDocument || iframe.contentWindow.document;<br>        var father  = document.getElementById(‘myblog_style_page’);<br>        iframedoc.body.innerHTML = iframedoc.body.innerHTML + father.innerHTML ;<br>        resizeIframe(iframe);<br>        father.innerHTML = “”;</p>
<pre><code>});
</code></pre><p>&lt;/script&gt;<br>&lt;?php get_footer(); ?&gt;<br>关于模板的详细说明，请参照 wordpress官方文档（<a href="https://codex.wordpress.org/zh-cn:页面" target="_blank" rel="noopener">中文</a>，<a href="https://developer.wordpress.org/themes/template-files-section/page-template-files/" target="_blank" rel="noopener">英文</a>）。这里我只说明重要的部分：</p>
<p>下面这段代码是用来加载用户在wordpress编辑器中输入的内容的，也就是新建页面，套用我们上面那个模板，用户在wordpress编辑器中输入的内容将会由以下代码段获取：</p>
<p><pre class="lang:php decode:true ">&lt;?php /<em> Start the Loop </em>/ ?&gt;<br>&lt;?php while(have_posts()) : the_post(); ?&gt;<br>&lt;?php the_content();?&gt;<br>&lt;?php endwhile; ?&gt;</pre><br>我们将上面那段代码放进了一个div里，如下面的代码所示：</p>
<p><pre class="lang:php decode:true">&lt;div id=”myblog_style_page” style=”margin-left:45px;margin-right:45px;”&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;</a> type=’text/css’ /&gt;<br>&lt;script type=’text/javascript’ src=’<a href="http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script">http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script</a>&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;</a> type=’text/css’ /&gt;</pre></p>
<p>&lt;div class=”container”&gt;</p>
<p>&lt;?php /<em> Start the Loop </em>/ ?&gt;<br>&lt;?php while(have_posts()) : the_post(); ?&gt;<br>&lt;?php the_content();?&gt;<br>&lt;?php endwhile; ?&gt;</p>
<p>&lt;/div&gt;<br>&lt;/div&gt;<br>在class为container的div里，我们将会加载用户输入的页面内容，然后在外层div我们会引入我们需要的样式表文件和jquery文件。外层div是有id属性的，因为待会我们需要获取这个div里面的内容。</p>
<p>接下来，我们在紧接着上面的代码定义了一个iframe，并设置没有边框和隐藏滚动条。这样它看起来会更像页面的一部分。iframe代码如下：</p>
<p><pre class="lang:php decode:true ">&lt;iframe id=”result”  frameBorder=”0” style=”overflow:hidden;”&gt;<br>&lt;/iframe&gt;</pre><br>接下来我们要添加script，在网页加载完毕后执行script，js代码如下：</p>
<p><pre class="lang:js decode:true">&lt;script&gt;<br>  function resizeIframe(obj) {<br>    obj.style.height = obj.contentWindow.document.body.scrollHeight + ‘px’;<br>  }<br>    $(document).ready(function () {<br>        var iframe = document.getElementById(‘result’),<br>        iframedoc = iframe.contentDocument || iframe.contentWindow.document;<br>        var father  = document.getElementById(‘myblog_style_page’);<br>        iframedoc.body.innerHTML = iframedoc.body.innerHTML + father.innerHTML ;<br>        resizeIframe(iframe);<br>        father.innerHTML = “”;</pre></p>
<pre><code>});
</code></pre><p>&lt;/script&gt;<br>resizeIframe(obj)函数用来将iframe的高度设置为和页面高度一致。 在$(document).ready()函数中，我们获取了id为myblog_style_page的div的内部HTML然后将其复制到iframe里面，再清空myblog_style_page的值。到这里，页面应该已经可以正常显示原有样式了（参照本站的<a href="http://akakanch.com/about/">关于页面</a>和我的<a href="http://akakanch.com/myprojects/">项目页面</a>）。</p>
<p>&nbsp;</p>
<p>接下来我们要上传这个模板和相应的css，js文件到相应的位置。</p>
<p>首先要找到你正在使用的wordpress主题，wordpress主题目录如下：</p>
<blockquote>
<p>/usr/share/nginx/html/wp-content/themes<br>我使用的nisarg，相应的目录为/usr/share/nginx/html/wp-content/themes/nisarg，打开上面目录后我们可以看到下图中的文件：</p>
</blockquote>
<p>&nbsp;</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/09/addasdasda.png"><img src="http://akakanch.com/wp-content/uploads/2017/09/addasdasda-300x160.png" alt=""></a></p>
<p>接下来，我们只需要将相应的css，js和刚刚创建的模板上传到相应的文件夹即可。最后创建页面，在右侧选择相应的页面模板，编辑完页面内容后发布页面，就可以正常显示了。</p>
<p><span style="color: #ff0000;"><em>**已知缺点：由于我们直接把模板文件和样式表放在主题目录里面的，在更新主题后，这些东西将会消失！</em></span></p>
 
    </div>
    <div class="post-foot">
        <div id="disqus_thread"></div>
    </div>
</div>


                </section>
                <footer class="container fixed-690 footer">
    <div>
        <span>Power by <a href="https://hexo.io">Hexo</a></span>
    </div>
    <div>
        <span>Theme <a href="https://github.com/zhengxiaowai/hexo-theme-lessless">lessless</a></span>
    </div>
        
            
<div>
    <span id="hexiangyutest_container_site_pv">
    PV: <span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv">
    UV: <span id="busuanzi_value_site_uv"></span>
    </span>
</div>

        
</footer>
        </div>
        
<script src="/js/jquery-3.2.1.slim.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


    

    </body>
</html>