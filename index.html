<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="personal blog of Long Zhang (kanchisme@gmail.com)">
<meta property="og:type" content="website">
<meta property="og:title" content="akakanch">
<meta property="og:url" content="http://akakanch.com/index.html">
<meta property="og:site_name" content="akakanch">
<meta property="og:description" content="personal blog of Long Zhang (kanchisme@gmail.com)">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="akakanch">
<meta name="twitter:description" content="personal blog of Long Zhang (kanchisme@gmail.com)">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://akakanch.com/"/>





  <title>akakanch</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">akakanch</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            Über
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2018/03/12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/12/" itemprop="url">about</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-12T17:12:39+08:00">
                2018-03-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="About-Me"><a href="#About-Me" class="headerlink" title="About Me"></a>About Me</h1><p><img src="http://akakanch.com/wp-content/uploads/2016/01/QQ图片20160115131732-300x298.png" alt=""></p>
<p>Name: Long Zhang</p>
<p>Location: Chengdu,China</p>
<p>Email: kanch is me @ gmail.com</p>
<p>Computer Science Major 2015</p>
<p>@</p>
<p>Chengdu University of Information Technology</p>
<h1 id="About-This-Site"><a href="#About-This-Site" class="headerlink" title="About This Site"></a>About This Site</h1><p>本博客用于写一些技术文章啥的，主要关于<strong>C++**</strong>Python**，还有自己平时在课堂上学到的一些东西.</p>
<p>同时该博客也用于托管一些我的项目页面。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2018/02/26/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/26/" itemprop="url">HMMC - How Much Money Do I Cost On Steam</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-02-26T15:18:27+08:00">
                2018-02-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/" itemprop="url" rel="index">
                    <span itemprop="name">C++ / Visual C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp;</p>
<p><pre class="lang:js decode:true ">function hmmc(){</pre></p>
<pre><code>//currency exchange
var CUR = [&apos;¥&apos;,&apos;$&apos;,&apos;€&apos;,&apos;£&apos;,&apos;₽&apos;,&apos;CDN$&apos;,&apos;₩&apos;];
var CUR_RMB = [1.0,6.3,7.7,8.8,0.1,5,0.0059];

//box to show info
var loading = `&amp;lt;div class=&quot;home_area_spotlight&quot; style=&quot;height:80px;width:100%;display:inline-block;&quot;&amp;gt;
               &amp;lt;div class=&quot;spotlight_content&quot; style=&quot;width:100%;text-align:center;&quot;&amp;gt;
                  &amp;lt;h2&amp;gt;Loading the costs in &amp;lt;/h2&amp;gt;
                  &amp;lt;div class=&quot;spotlight_body&quot;&amp;gt;RMB &amp;lt;/div&amp;gt;
                  &amp;lt;div class=&quot;spotlight_body spotlight_price price&quot;&amp;gt;
                     &amp;lt;div class=&quot;discount_block discount_block_spotlight discount_block_large&quot;&amp;gt;
                        &amp;lt;div class=&quot;discount_pct&quot; id=&quot;spent_money&quot;&amp;gt;wait few seconds...&amp;lt;/div&amp;gt;
                     &amp;lt;/div&amp;gt;
                  &amp;lt;/div&amp;gt;
               &amp;lt;/div&amp;gt;
               &amp;lt;div class=&quot;ds_options&quot;&amp;gt;
                  &amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;
               &amp;lt;/div&amp;gt;
            &amp;lt;/div&amp;gt;`;

var donestr = `&amp;lt;div class=&quot;home_area_spotlight&quot; style=&quot;height:80px;width:100%;display:inline-block;&quot;&amp;gt;
               &amp;lt;div class=&quot;spotlight_content&quot; style=&quot;width:100%;text-align:center;&quot;&amp;gt;
                  &amp;lt;h2&amp;gt;You have spent&amp;lt;/h2&amp;gt;
                  &amp;lt;div class=&quot;spotlight_body&quot;&amp;gt;RMB &amp;lt;/div&amp;gt;
                  &amp;lt;div class=&quot;spotlight_body spotlight_price price&quot;&amp;gt;
                     &amp;lt;div class=&quot;discount_block discount_block_spotlight discount_block_large&quot;&amp;gt;
                        &amp;lt;div class=&quot;discount_pct&quot; id=&quot;spent_money&quot;&amp;gt;@SPENT@&amp;lt;/div&amp;gt;
                     &amp;lt;/div&amp;gt;
                  &amp;lt;/div&amp;gt;
               &amp;lt;/div&amp;gt;
               &amp;lt;div class=&quot;ds_options&quot;&amp;gt;
                  &amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;
               &amp;lt;/div&amp;gt;
            &amp;lt;/div&amp;gt;`;
// target div before our box
var ppt = document.querySelector(&quot;body &amp;gt; div.page_header_ctn.account_management&quot;);
ppt.insertAdjacentHTML(&quot;afterend&quot;, loading);

//load all wallet transactions

console.log(&quot;Loading all transactions....&quot;); 
WalletHistory_LoadMore();

console.log(&quot;done.\r\nWaiting for 8 seconds...&quot;); 
 setTimeout(function() {
    //extract all transactions
    var costRM = [];
    var cc = document.getElementsByClassName(&apos;wht_wallet_change&apos;);
    var change = document.getElementsByClassName(&apos;wht_total&apos;);
    var balance = document.getElementsByClassName(&apos;wht_wallet_balance&apos;);
    for (var i = 1; i &amp;lt; cc.length; i++) {
        if(change[i].textContent.length &amp;gt;1){
            //check if it is expenditure
            if((cc[i].textContent.length &amp;gt; 3 &amp;amp;&amp;amp; cc[i].textContent[0]==&apos;-&apos;) || (cc[i].textContent.length &amp;lt; 2 &amp;amp;&amp;amp; balance[i].textContent.length &amp;lt; 2)){
                var vv =  change[i].textContent.replace(/[^\-+.0-9]/g,&apos;&apos;);
                var oly = change[i].textContent.replace(/[^\-+.0-9฿₵¢₡B₫€ƒ₲Kč₭£₤₥₦₱₨₽$₮₩¥₴₪֏¥]/g,&apos;&apos;);
                //convert currency to RMB 
                vv = CUR_RMB[CUR.indexOf(oly[0])]*parseFloat(vv);
                costRM.push( parseFloat(vv) );
            }
        }
    }

    // compute all cost
    var X = costRM.reduce(function(a, b) { return a + b; }, 0);
    console.log(&apos;done.\r\n-\r\n-\r\nYou have cost ¥ &apos; + Number((X).toFixed(2)) + &apos; RMB on Steam so far.\r\n-\r\n-\r\n&apos;);
    document.querySelector(&quot;body &amp;gt; div.home_area_spotlight&quot;).remove();
    ppt.insertAdjacentHTML(&quot;afterend&quot;, donestr.replace(&quot;@SPENT@&quot;,Number((X).toFixed(2))));
 },8888);
</code></pre><p>}<br>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2017/09/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/27/" itemprop="url">图像中的字符定位与分割（Python实现）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-27T00:03:01+08:00">
                2017-09-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/数据分析/" itemprop="url" rel="index">
                    <span itemprop="name">数据分析</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/数据分析/算法、/" itemprop="url" rel="index">
                    <span itemprop="name">算法、</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>假设我们有如下图像：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/09/test.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/09/test-300x300.jpg" alt=""></a></p>
<p>现在我们想要将图片中的数字一个一个分割出来。</p>
<p>在处理之前，我们首先应该将图像去RGB，即在它对应的灰度图像上进行处理。我们可以使用opencv python库中的</p>
<p><div></div></p>
<p><div>cvtColor函数来实现到灰度图像的转换。转换代码以及转换结果（归一化后）如下：</div><br></p>
<p><div></div></p>
<p><pre class="lang:python decode:true ">grayscaleimg = cv2.cvtColor(rawimg,cv2.COLOR_BGR2GRAY)</pre><br><a href="http://akakanch.com/wp-content/uploads/2017/09/gsi.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/09/gsi-300x272.jpg" alt=""></a></p>
<p>然后，我们需要对图片进行归一化，这样可以减少最后分割出的数字中的噪声：</p>
<p><pre class="lang:python decode:true ">grayscaleimg = grayscaleimg - int(np.mean(grayscaleimg))<br>grayscaleimg[grayscaleimg &lt; 50] = 0</pre><br>这里我们采取了对每个像素减去图像总像素的平均数，并设置阈值50以下的像素归零来实现归一化，归一化后的图像即上图所示。</p>
<p>接下来，我们需要确定分割边界，由于我们已经将背景的像素值归一化为0，我们只需要对图像分别从x方向（列扫描）和y方向（行扫描）进行扫描，统计每一行/列的0和非0值的个数即可。统计完毕绘图如下（行扫描在左，列扫描在右）：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/09/yyyy.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/09/yyyy-300x235.jpg" alt=""></a><a href="http://akakanch.com/wp-content/uploads/2017/09/xxxx.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/09/xxxx-300x218.jpg" alt=""></a></p>
<p><br>&nbsp;</p>
<p>我们可以看到，行扫描结果让我们了解到了数字在y轴方向上的上下限，列扫描帮助我们了解到了每个数字之间的间隔位置（即值为0的地方，右图波谷）。在下图中，上边的左图对应下图红色之间的部分，右图的波谷（值为0的部分）对应下图中的橙色线段。</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/09/111.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/09/111-300x296.jpg" alt=""></a></p>
<p><div>接下来，我们只需要将图像从y方向切割出来，再遍历x方向的所有临界点（即从非零值到零值，或者从零值到非零值的点），即可切分出字符。</div></p>
<p><div>**如果图像中的问题连着一起的怎么办？</div></p>
<p><div>设定一定的阈值，当某列的非零值小于该阈值，则认为此列为黏带列，应该从这里分割。</div></p>
<p><div></div></p>
<p><div>完整的Python代码如下：</div></p>
<p><div></div></p>
<p><pre class="lang:python decode:true ">from matplotlib import pyplot as plt<br>import numpy as np<br>import cv2</pre></p>
<p>rawimg = cv2.imread(“./test.jpg”)<br>rawimg = rawimg - 246<br>fig = plt.figure()<br>fig.add_subplot(2,3,1)<br>plt.title(“raw image”)<br>plt.imshow(rawimg)</p>
<p>fig.add_subplot(2,3,2)<br>plt.title(“grey scale image”)<br>grayscaleimg = cv2.cvtColor(rawimg,cv2.COLOR_BGR2GRAY)<br>plt.imshow(grayscaleimg,cmap=’gray’)</p>
<h1 id="counting-non-zero-value-by-row-axis-y"><a href="#counting-non-zero-value-by-row-axis-y" class="headerlink" title="counting non-zero value by row , axis y"></a>counting non-zero value by row , axis y</h1><p>row_nz = []<br>for row in grayscaleimg.tolist():<br>    row_nz.append(len(row) - row.count(0))<br>fig.add_subplot(2,3,3)<br>plt.title(“non-zero values on y (by row)”)<br>plt.plot(row_nz)</p>
<h1 id="counting-non-zero-value-by-column-x-axis"><a href="#counting-non-zero-value-by-column-x-axis" class="headerlink" title="counting non-zero value by column, x axis"></a>counting non-zero value by column, x axis</h1><p>col_nz = []<br>for col in grayscaleimg.T.tolist():<br>    col_nz.append(len(col) - col.count(0))<br>fig.add_subplot(2,3,4)<br>plt.title(“non-zero values on y (by col)”)<br>plt.plot(col_nz)</p>
<h5 id="start-split"><a href="#start-split" class="headerlink" title="start split"></a>start split</h5><h1 id="first-find-upper-and-lower-boundary-of-y-row"><a href="#first-find-upper-and-lower-boundary-of-y-row" class="headerlink" title="first find upper and lower boundary of y (row)"></a>first find upper and lower boundary of y (row)</h1><p>fig.add_subplot(2,3,5)<br>plt.title(“y boudary deleted”)<br>upper_y = 0<br>for i,x in enumerate(row_nz):<br>    if x != 0:<br>        upper_y = i<br>        break<br>lower_y = 0<br>for i,x in enumerate(row_nz[::-1]):<br>    if x!=0:<br>        lower_y = len(row_nz) - i<br>        break<br>sliced_y_img = grayscaleimg[upper_y:lower_y,:]<br>plt.imshow(sliced_y_img)</p>
<h1 id="then-we-find-left-and-right-boundary-of-every-digital-x-on-column"><a href="#then-we-find-left-and-right-boundary-of-every-digital-x-on-column" class="headerlink" title="then we find left and right boundary of every digital (x, on column)"></a>then we find left and right boundary of every digital (x, on column)</h1><p>fig.add_subplot(2,3,6)<br>plt.title(“x boudary deleted”)<br>column_boundary_list = []<br>record = False<br>for i,x in enumerate(col_nz[:-1]):<br>    if (col_nz[i] == 0 and col_nz[i+1] != 0) or col_nz[i] != 0 and col_nz[i+1] == 0:<br>        column_boundary_list.append(i+1)<br>img_list = []<br>xl = [ column_boundary_list[i:i+2] for i in range(0,len(column_boundary_list),2) ]<br>for x in xl:<br>    img_list.append( sliced_y_img[:,x[0]:x[1]] )</p>
<h1 id="del-invalid-image"><a href="#del-invalid-image" class="headerlink" title="del invalid image"></a>del invalid image</h1><p>img_list = [ x for x in img_list if x.shape[1] &gt; 5 ]</p>
<h1 id="show-image"><a href="#show-image" class="headerlink" title="show image"></a>show image</h1><p>fig = plt.figure()<br>for i,img in enumerate(img_list):<br>    fig.add_subplot(3,4,i+1)<br>    plt.imshow(img)<br>    plt.imsave(“./result/%s.jpg”%i,img)<br>plt.show()</p>
<p><br>&nbsp;</p>
<p></p>
<p><div></div><br>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2017/09/16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/16/" itemprop="url">在Ubuntu 16.04上使用 Nginx 和 Gunicorn 托管 Python Flask网站</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-16T16:02:40+08:00">
                2017-09-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/网站制作相关/翻译/" itemprop="url" rel="index">
                    <span itemprop="name">翻译</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/网站制作相关/翻译/转载/" itemprop="url" rel="index">
                    <span itemprop="name">转载</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div class="important-comment" style="background: #334455; color: gray; padding: 10px; border-radius: 25px; margin-top: 8px; margin-bottom: 25px;">翻译至：<span style="color: #ff6600;"><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-gunicorn-and-nginx-on-ubuntu-16-04" target="_blank" rel="noopener">How To Serve Flask Applications with Gunicorn and Nginx on Ubuntu 16.04</a> </span></div>

<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>通过这个教程我们将会学习到如何利用Gunicorn 结合 Nginx 使 Flask 应用程序运行在Ubuntu 16.04上。本文的大部分内容将介绍如何设置Gunicorn应用程序服务器以启动应用程序，并将Nginx用作前端反向代理。</p>
<h2 id="教程开始之前…"><a href="#教程开始之前…" class="headerlink" title="教程开始之前…"></a>教程开始之前…</h2><p>你需要一个可以执行 sudo 命令的用户账户，系统上应该确保安装了systemd （注意，不是upstart）。如果有<a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-uwsgi-and-nginx-to-serve-python-apps-on-ubuntu-14-04#definitions-and-concepts" target="_blank" rel="noopener">WSGI的相关知识</a>那就更好不过了，不过没有也不影响。</p>
<h2 id="安装相关组件"><a href="#安装相关组件" class="headerlink" title="安装相关组件"></a>安装相关组件</h2><p>这一步我们将会安装 Python 包管理程序 pip 和 Nginx。</p>
<p>如果你的版本为 Python 2.x，使用以下命令安装：</p>
<pre class="lang:sh decode:true">sudo apt-get update
sudo apt-get install python-pip python-dev nginx</pre>
如果你的版本是Python 3.x， 使用以下命令：
<pre class="lang:sh decode:true ">sudo apt-get update
sudo apt-get install python3-pip python3-dev nginx</pre>

<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><p>略</p>
<h2 id="设置-Flask-应用程序"><a href="#设置-Flask-应用程序" class="headerlink" title="设置 Flask 应用程序"></a>设置 Flask 应用程序</h2><p>首先我们需要安装Flask 和 Gunicorn，通过以下命令进行安装：</p>
<pre class="lang:sh decode:true ">pip install gunicorn flask</pre>
如果你使用的Python 3，请使用以下命令：
<pre class="lang:sh decode:true ">pip3 install gunicorn flask</pre>
接下来我们创建 flask 应用程序，我们取名为 myproject.py，其代码如下：
<pre class="lang:python decode:true">from flask import Flask
app = Flask(__name__)

@app.route("/")
def hello():
    return "&lt;h1 style='color:blue'&gt;Hello There!&lt;/h1&gt;"

if __name__ == "__main__":
    app.run(host='0.0.0.0')</pre>
上面的代码定义了一个非常简单的页面，并将其绑定到本地根域名。

为了访问我们的flask应用程序，首先，我们需要打开 5000端口。通过以下命令打开5000端口：
<pre class="lang:sh decode:true ">sudo ufw allow 5000</pre>
紧接着，我们开始运行我们的 flask 应用程序：
<pre class="lang:sh decode:true ">python myproject.py</pre>
然后我们通过主机名或者我们服务器的IP地址来访问该程序，再浏览器中输入以下地址：
<pre class="lang:sh decode:true ">http://server_domain_or_IP:5000</pre>
一切正常的话，你的应该看起来和下图一样:

![Flask sample app](https://assets.digitalocean.com/articles/nginx_uwsgi_wsgi_1404/test_app.png)

这里配置完毕后，我们通过再控制台按 Ctrl + C命令来结束我们的flask应用程序。

## 创建WSGI入口脚本

接下来，我们将创建一个脚本文件，作为我们应用程序的入口点。这个脚本将告诉我们的Gunicorn服务器应该如何与应用程序进行交互。

我们将文件命名为 wsgi.py，创建文件:
<pre class="lang:sh decode:true ">nano ~/myproject/wsgi.py</pre>
文件内容如下，只是简单的导入我们flask应用程序的app模块：
<pre class="lang:python decode:true ">from myproject import app

if __name__ == "__main__":
    app.run()</pre>
文件写好后保存并推出，接下来我们进行下一步。

## 测试 Gunicorn 能否正常托管我们的flask应用程序

接下来我们测试 Gunicorn是否正常工作。

我们可以通过简单的讲WSGI入口名称传递给Gunicorn，测试是否正常运行。WSGI入口名字通常由以下部分组成：
<pre class="lang:c++ decode:true ">WSGI入口名称 = 模块名称 + 应用程序中可调用名称</pre>
模块名称即WSGI脚本名称（不含文件扩展名），应用程序中可调用名称即 flask 中的 app = Flask(__name__)。在我们的例子中，WSGI入口名称为 wsgi:app 。

在运行Gunicorn的过程中我们同时需要指定 IP地址和端口来确保可以正常访问。
<pre class="lang:sh decode:true ">cd ~/myproject
gunicorn --bind 0.0.0.0:5000 wsgi:app</pre>
还是和刚刚直接测试 flask 脚本相同，请在浏览器输入以下地址进行访问：
<pre class="lang:sh decode:true ">http://server_domain_or_IP:5000</pre>
如果出现下图，即表示可以正常运行。

![Flask sample app](https://assets.digitalocean.com/articles/nginx_uwsgi_wsgi_1404/test_app.png)

## 创建 Systemd 单元文件

接下来我们需要创建一个systemd 系统服务文件。该文件将允许Ubuntu在开机的时候自动启动Gunicorn，并为我们的Flask应用程序提供服务。通过这个文件，我们的 flask应用程序已经成为系统的一个服务，可以通过 service 命令来启动/关闭以及重新启动。

创建文件：
<pre class="lang:sh decode:true ">sudo nano /etc/systemd/system/myproject.service</pre>
在这个文件里面，我们将从[Unit]部分开始，该部分用于指定元数据和依赖关系。我们将在这里描述我们的服务，并告诉init系统只有在达到网络目标后才能启动它（联网?）。
<pre class="lang:sh decode:true ">[Unit]
Description=Gunicorn instance to serve myproject
After=network.target</pre>
接下来，我们编写 [Service] 部分，我们将会指定该服务使用何种用户账户运行。由于flask程序拥有所有必不可少的运行文件，因此我们会给予其常规的用户帐户所有权。我们将会赋予它为 www-data 用户组，这样Nginx和它数据交换更加容易。

然后我们设置工作路径和 PATH 环境变量，这样 初始化系统 就知道Gunicorn可执行程序在哪里。 Systemd 要求我们以完整路径名指定可执行程序。如果你不知道完整路径，可以尝试：
<pre class="lang:sh decode:true">locate [name]</pre>
或者
<pre class="lang:sh decode:true ">which name</pre>
我们将会设置 Gunicorn开启3个工作线程（根据您的需求更改）。我们同时会令 Gunicorn 绑定一个 命名为 myproject.socket 位于我们工作目录的Unix 套接字文件。设置套接字文件的 umask为 007这样该文件仅能被和myproject服务相同的用户组访问。最后，我们需要将WSGI入口名称传递给Gunicorn，截至目前，myproject.service内容如下:
<pre class="lang:sh decode:true ">[Unit]
Description=Gunicorn instance to serve myproject
After=network.target

[Service]
User=sammy
Group=www-data
WorkingDirectory=/home/sammy/myproject
Environment="PATH=/home/sammy/myproject/myprojectenv/bin"
ExecStart=/home/sammy/myproject/myprojectenv/bin/gunicorn --workers 3 --bind unix:myproject.sock -m 007 wsgi:app</pre>
最后，我们会需要添加[Install]块，这可以让 systemd 知道应该在哪种系统启动模式时启动服务。我们希望让这个服务在正常启动系统时随系统启动：
<pre class="lang:sh decode:true ">[Unit]
Description=Gunicorn instance to serve myproject
After=network.target

[Service]
User=sammy
Group=www-data
WorkingDirectory=/home/sammy/myproject
Environment="PATH=/home/sammy/myproject/myprojectenv/bin"
ExecStart=/home/sammy/myproject/myprojectenv/bin/gunicorn --workers 3 --bind unix:myproject.sock -m 007 wsgi:app

[Install]
WantedBy=multi-user.target</pre>
至此，我们的 systemd服务文件已经完成。

我们现在可以启动该服务，并令其在系统开机时自动启动：
<pre class="lang:sh decode:true ">sudo systemctl start myproject
sudo systemctl enable myproject</pre>

<h2 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h2><p>我们的Gunicorn程序目前应该可以正常运行了。接下来我们要配置Nginx来传递网络请求到刚刚创建的套接字文件，这样才能够访问到我们的flask应用程序。</p>
<p>我们可以在Niginx的sites-available文件夹下新增配置文件，避免修改默认配置文件。</p>
<p>我们将我们的配置文件命名为 myproject：</p>
<p><pre class="lang:sh decode:true ">sudo nano /etc/nginx/sites-available/myproject</pre><br>在文件里面下入以下内容：</p>
<p><pre class="lang:sh decode:true">server {<br>    listen 80;<br>    server_name server_domain_or_IP;</pre></p>
<pre><code>location / {
    include proxy_params;
    proxy_pass http://unix:/home/sammy/myproject/myproject.sock;
}
</code></pre><p>}<br>我们需要修改上述文件内容中的 server_domain_or_IP，server_domain_or_IP设置为你的域名或者IP地址。 如果你没有使用套接字文件，而是绑定IP端口的形式，请修改 proxy_pass后面的内容到您flask应用程序绑定的对应IP和端口。</p>
<p>保存文件，接下来我们需要让这个配置文件生效，将该文件链接到Nginx的<code>sites-enabled</code>文件目录：</p>
<p><pre class="lang:sh decode:true ">sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled</pre><br>接下来我们测试Nginx配置文件是否有错误：</p>
<p><pre class="lang:sh decode:true ">sudo nginx -t</pre><br>如果该命令没有输出任何错误信息，我们就可以重启我们的nginx服务器，使配置文件生效：</p>
<p><pre class="lang:sh decode:true ">sudo systemctl restart nginx</pre><br>如果你启用了防火墙，接下来我们就可以关闭5000端口的访问，开启Nginx的外网访问：</p>
<p><pre class="lang:sh decode:true ">sudo ufw delete allow 5000<br>sudo ufw allow ‘Nginx Full’</pre><br>你现在应该可以通过服务器域名或者IP地址从外网访问您的flask应用程序了。</p>
<p><pre class="lang:sh decode:true "><a href="http://server_domain_or_IP" target="_blank" rel="noopener">http://server_domain_or_IP</a></pre><br>它应该看起来如下：</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><img src="https://assets.digitalocean.com/articles/nginx_uwsgi_wsgi_1404/test_app.png" alt="Flask sample app">总结</h2><p>我们创立了一个建议flask应用程序，同时我们创建了 WSGI 入口点，这样任何支持 WSGI的服务程序都可以支持我们的flask应用（我们使用的Gunicorn完成这一功能）。</p>
<p>然后我们创建了systemd系统服务文件来让我们的flask应用程序开机自动启动。我们还配置了Nginx来反向代理我们的服务器。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2017/09/14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/14/" itemprop="url">Wordpress 添加自定义模板并创建基于bootstrap4的页面</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-14T23:03:05+08:00">
                2017-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近我写了一个博客系统（<a href="https://github.com/ankanch/myblog" target="_blank" rel="noopener">myblog</a>），原本打算替换掉wordpress的，但是后面发现wordpress可以自定义模板，故将myblog的部分样式应用到自定义页面模板上，本来以为只需要简单的创建模板，然后导入css和js即可，结果发现导入后界面完全乱了，甚至还影响了属于wordpress的部分（footer和header）。</p>
<p>由于我的myblog需要bootstrap 4的支持，所以需要额外导入bootstrap 4的样式表，但是由于我使用的主题使用了低版本的样式表，如果直接在模板页面导入会照成我导入的覆盖掉主题默认使用的，导致界面混乱。在经过一番搜索后，找到了如下几个解决方案：</p>
<ol>
<li>使用iframe</li>
<li>手动添加 容器ID来限定每个样式的作用域</li>
<li>使用第三方插件如：<a href="https://github.com/thingsinjars/jQuery-Scoped-CSS-plugin" target="_blank" rel="noopener">Simon Madine’s jQuery Scoped CSS plugin</a>.<br>我首先尝试了方法二，写了个python脚本帮助实现，但是对于 @media之类的，就无能为力了，故放弃。</li>
</ol>
<p>然后尝试方法一，有效的方法。如下：</p>
<p>首先我们要创建一个自定义模板，以myblog_theme_page.php为例，其代码如下：</p>
<p>myblog_theme_page.php:</p>
<p><pre class="lang:php decode:true">&lt;?php<br>/<em><br>Template Name: myblog_theme
</em>/<br> get_header(); ?&gt;</pre></p>
<p>&lt;div id=”primary” class=”site-content-fullwidth” style=”background:white;”&gt;<br>  &lt;div id=”content” role=”main” style=”background:white;”&gt;<br>&lt;div id=”myblog_style_page” style=”margin-left:45px;margin-right:45px;”&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;</a> type=’text/css’ /&gt;<br>&lt;script type=’text/javascript’ src=’<a href="http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script">http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script</a>&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;</a> type=’text/css’ /&gt;<br>&lt;div class=”container”&gt;<br>&lt;?php /<em> Start the Loop </em>/ ?&gt;<br>&lt;?php while(have_posts()) : the_post(); ?&gt;<br>&lt;?php the_content();?&gt;<br>&lt;?php endwhile; ?&gt;</p>
<p>&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;iframe id=”result”  frameBorder=”0” style=”overflow:hidden;”&gt;<br>&lt;/iframe&gt;<br>  &lt;/div&gt;&lt;!– #content –&gt;<br>&lt;/div&gt;&lt;!– #primary –&gt;<br>&lt;script&gt;<br>  function resizeIframe(obj) {<br>    obj.style.height = obj.contentWindow.document.body.scrollHeight + ‘px’;<br>  }<br>    $(document).ready(function () {<br>        var iframe = document.getElementById(‘result’),<br>        iframedoc = iframe.contentDocument || iframe.contentWindow.document;<br>        var father  = document.getElementById(‘myblog_style_page’);<br>        iframedoc.body.innerHTML = iframedoc.body.innerHTML + father.innerHTML ;<br>        resizeIframe(iframe);<br>        father.innerHTML = “”;</p>
<pre><code>});
</code></pre><p>&lt;/script&gt;<br>&lt;?php get_footer(); ?&gt;<br>关于模板的详细说明，请参照 wordpress官方文档（<a href="https://codex.wordpress.org/zh-cn:页面" target="_blank" rel="noopener">中文</a>，<a href="https://developer.wordpress.org/themes/template-files-section/page-template-files/" target="_blank" rel="noopener">英文</a>）。这里我只说明重要的部分：</p>
<p>下面这段代码是用来加载用户在wordpress编辑器中输入的内容的，也就是新建页面，套用我们上面那个模板，用户在wordpress编辑器中输入的内容将会由以下代码段获取：</p>
<p><pre class="lang:php decode:true ">&lt;?php /<em> Start the Loop </em>/ ?&gt;<br>&lt;?php while(have_posts()) : the_post(); ?&gt;<br>&lt;?php the_content();?&gt;<br>&lt;?php endwhile; ?&gt;</pre><br>我们将上面那段代码放进了一个div里，如下面的代码所示：</p>
<p><pre class="lang:php decode:true">&lt;div id=”myblog_style_page” style=”margin-left:45px;margin-right:45px;”&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/bootstrap4alpha.css&#39;</a> type=’text/css’ /&gt;<br>&lt;script type=’text/javascript’ src=’<a href="http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script">http://akakanch.com/wp-content/themes/nisarg/js/jquery-3.2.1.min.js&#39;&gt;&lt;/script</a>&gt;<br>&lt;link rel=’stylesheet’  href=’<a href="http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;">http://akakanch.com/wp-content/themes/nisarg/css/xstyle.css&#39;</a> type=’text/css’ /&gt;</pre></p>
<p>&lt;div class=”container”&gt;</p>
<p>&lt;?php /<em> Start the Loop </em>/ ?&gt;<br>&lt;?php while(have_posts()) : the_post(); ?&gt;<br>&lt;?php the_content();?&gt;<br>&lt;?php endwhile; ?&gt;</p>
<p>&lt;/div&gt;<br>&lt;/div&gt;<br>在class为container的div里，我们将会加载用户输入的页面内容，然后在外层div我们会引入我们需要的样式表文件和jquery文件。外层div是有id属性的，因为待会我们需要获取这个div里面的内容。</p>
<p>接下来，我们在紧接着上面的代码定义了一个iframe，并设置没有边框和隐藏滚动条。这样它看起来会更像页面的一部分。iframe代码如下：</p>
<p><pre class="lang:php decode:true ">&lt;iframe id=”result”  frameBorder=”0” style=”overflow:hidden;”&gt;<br>&lt;/iframe&gt;</pre><br>接下来我们要添加script，在网页加载完毕后执行script，js代码如下：</p>
<p><pre class="lang:js decode:true">&lt;script&gt;<br>  function resizeIframe(obj) {<br>    obj.style.height = obj.contentWindow.document.body.scrollHeight + ‘px’;<br>  }<br>    $(document).ready(function () {<br>        var iframe = document.getElementById(‘result’),<br>        iframedoc = iframe.contentDocument || iframe.contentWindow.document;<br>        var father  = document.getElementById(‘myblog_style_page’);<br>        iframedoc.body.innerHTML = iframedoc.body.innerHTML + father.innerHTML ;<br>        resizeIframe(iframe);<br>        father.innerHTML = “”;</pre></p>
<pre><code>});
</code></pre><p>&lt;/script&gt;<br>resizeIframe(obj)函数用来将iframe的高度设置为和页面高度一致。 在$(document).ready()函数中，我们获取了id为myblog_style_page的div的内部HTML然后将其复制到iframe里面，再清空myblog_style_page的值。到这里，页面应该已经可以正常显示原有样式了（参照本站的<a href="http://akakanch.com/about/">关于页面</a>和我的<a href="http://akakanch.com/myprojects/">项目页面</a>）。</p>
<p>&nbsp;</p>
<p>接下来我们要上传这个模板和相应的css，js文件到相应的位置。</p>
<p>首先要找到你正在使用的wordpress主题，wordpress主题目录如下：</p>
<blockquote>
<p>/usr/share/nginx/html/wp-content/themes<br>我使用的nisarg，相应的目录为/usr/share/nginx/html/wp-content/themes/nisarg，打开上面目录后我们可以看到下图中的文件：</p>
</blockquote>
<p>&nbsp;</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/09/addasdasda.png"><img src="http://akakanch.com/wp-content/uploads/2017/09/addasdasda-300x160.png" alt=""></a></p>
<p>接下来，我们只需要将相应的css，js和刚刚创建的模板上传到相应的文件夹即可。最后创建页面，在右侧选择相应的页面模板，编辑完页面内容后发布页面，就可以正常显示了。</p>
<p><span style="color: #ff0000;"><em>**已知缺点：由于我们直接把模板文件和样式表放在主题目录里面的，在更新主题后，这些东西将会消失！</em></span></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2017/03/12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/12/" itemprop="url">成都信息工程大学四六级成绩分析 - 从数据获取到分析数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-12T16:16:46+08:00">
                2017-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/数据分析/" itemprop="url" rel="index">
                    <span itemprop="name">数据分析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="0-概要"><a href="#0-概要" class="headerlink" title="0.概要"></a>0.概要</h2><p>这篇文章对成都信息工程大学的四六级的成绩进行了分析。这篇文章涵盖了从数据的获取，到储存，到数据的分析。全文读完大概需要   20 分钟。</p>
<p>所有的数据通过合法途径且可公开获取，详细说明见文章末尾。</p>
<p>该文章涉及的所有数据，源代码均可在我的gihub账户下的 data analysis仓库获得，点击如下按钮即可下载：</p>
<p><span class="orange-botton" style="background: #f25759; color: #ffffff; padding: 10px; border-radius: 15px;"><a href="https://github.com/ankanch/data-analysis/tree/master/CUIT-%E8%AE%A1%E7%AE%97%E6%9C%BACET4%EF%BC%8C6%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2-%E5%88%86%E6%9E%90" target="_blank" rel="noopener"><span class="orange-botton" style="background: #f25759; color: #ffffff; padding: 3px; border-radius: 3px;">下载相关代码及数据</span></a></span></p>
<h2 id="1-数据的获取"><a href="#1-数据的获取" class="headerlink" title="1.数据的获取"></a>1.数据的获取</h2><p>为了分析四六级数据，首先我们需要获取数据。我们学校的教务处网站已经提供了通过学生姓名查询四六级成绩的功能（<a href="http://jxgl.cuit.edu.cn/Jxgl/Djks/Default.asp?Op=%b4%f3%d1%a7%d3%a2%d3%ef%b9%fa%bc%d2%c1%f9%bc%b6" target="_blank" rel="noopener">点击这里跳转至教务处</a>）。</p>
<p>我们只需要写一个简单的脚本遍历查询学生的姓名即可。为了获得学生姓名，我们也可以通过教务处网站的班级学生名单获得全校的学生名单（<a href="http://jxgl.cuit.edu.cn/jxgl/Cjd/ShowCls.asp?Limit=CSV%b8%f1%ca%bd" target="_blank" rel="noopener">点击这里跳转，需要登录</a>）。</p>
<p>接下来讲讲如何写脚本来获取四六级数据。</p>
<p>打开前面提到的教务处查询四六级的网站，我们可以看到只需要输入名字就可以查询到，而且URL并没有发生改变，网页源代码里面也没有js来提交数据。故这个页面只是简单的使用了HTML的表单来post数据到后端。</p>
<p>接下来我们用Fiddler抓包（Chrome的F12开发者模式也可以）。为了完全模仿新用户的行为，我们打开一个Chrome的隐身标签，然后访问该网站。我们可以看到，如下图所示：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/123.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/03/123.jpg" alt="123"></a></p>
<p>访问过程中发生了2次302重定向和2次200状态吗。其中有用的只有第一次，如上图所示。第一次302响应为我们设置了一个叫做ASPSESSIONIDCCDCSRDR的Cookies。后面通过构造post发现，如果带有错误的该项cookies或者无该项Cookies，都不能正常的请求到成绩数据。</p>
<p>故我们有了第一步，那就是需要先向这个页面发送GET请求来获取一个叫做ASPSESSIONIDCCDCSRDR的Cookies，然后之后构造的Post请求都需要带上这个Cookies。</p>
<p>Python下我们通过以下代码来获取一个cookies并永久保存用于之后的查询：</p>
<p>通过Python Rquests包的session来永久的保存一个Cookies集合。</p>
<p><pre class="lang:python decode:true">import requests</pre></p>
<p>#用于请求cookies<br>header = {<br>    ‘Host’: ‘jxgl.cuit.edu.cn’,<br>    ‘Connection’: ‘keep-alive’,<br>    ‘Upgrade-Insecure-Requests’: ‘1’,<br>    ‘User-Agent’: ‘Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36’,<br>    ‘Accept’: ‘text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8’,<br>    ‘Accept-Encoding’: ‘gzip, deflate, sdch’,<br>    ‘Accept-Language’: ‘zh-CN,en-US;q=0.8,en;q=0.6,zh;q=0.4’<br>}</p>
<p>#获取必要session<br>session = requests.Session()<br>session.get(“<a href="http://jxgl.cuit.edu.cn/Jxgl/Djks/Default.asp?Op=%B4%F3%D1%A7%D3%A2%D3%EF%B9%FA%BC%D2%C1%F9%BC%B6&quot;,headers=header" target="_blank" rel="noopener">http://jxgl.cuit.edu.cn/Jxgl/Djks/Default.asp?Op=%B4%F3%D1%A7%D3%A2%D3%EF%B9%FA%BC%D2%C1%F9%BC%B6&quot;,headers=header</a>)<br>print(session.cookies.get_dict())<br>接下里我们继续分析，我们继续抓包，这次我们抓取当我们在查询页面输入学生姓名然后点击查询的时候，浏览器发送的数据包。</p>
<p>Fiddler抓包信息如下：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/345.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/03/345.jpg" alt="345"></a></p>
<p>从上图可以看出，在post查询请求的时候，带上了ASPSESSIONIDCCDCSRDR这个Cookies，另外再看服务器响应的该查询请求，响应长度为12944，这说明正确返回了所需要的信息。如果这个值太小（比如1000左右），有可能是返回了其他页面，即我们构造post请求失败。</p>
<p>再看下面这张图，下面这张图是当我们向服务器发送查询命令的时候浏览器发送给服务器的表单数据。通过分析，我们发现，图中1，2，3分别指定了查询的成绩类型，学生姓名和查询的考试时间。</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/678.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/03/678.jpg" alt="678"></a></p>
<p>上图的源数据如下：</p>
<p><pre class="lang:php decode:true ">func=login&amp;Op=%B4%F3%D1%A7%D3%A2%D3%EF%B9%FA%BC%D2%C1%F9%BC%B6&amp;hdName=&amp;HdXm=%D5%C5%C1%FA&amp;TheTime=20161217&amp;imageField22.x=23&amp;imageField22.y=18</pre><br>其中Op，HdXm我们通过搜索知道为GB2312编码，故在我们的post请求中也需要构造编码后的以上两个关键字段。为了完全模仿浏览器行为，在查询的时候，我们也需要post一个和浏览器一模一样的查询header。</p>
<p>通过以下Python代码实现构造查询用的header和查询学生成绩（需要结合上面提到的代码）：</p>
<p><pre class="lang:python decode:true ">#用于请求成绩的header<br>headerget = {<br>    ‘Host’: ‘jxgl.cuit.edu.cn’,<br>    ‘Connection’: ‘keep-alive’,<br>    ‘Content-Length’: ‘140’,<br>    ‘Cache-Control’: ‘max-age=0’,<br>    ‘Origin’: ‘<a href="http://jxgl.cuit.edu.cn&#39;" target="_blank" rel="noopener">http://jxgl.cuit.edu.cn&#39;</a>,<br>    ‘Upgrade-Insecure-Requests’: ‘1’,<br>    ‘User-Agent’: ‘Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36’,<br>    ‘Content-Type’: ‘application/x-www-form-urlencoded’,<br>    ‘Accept’: ‘text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8’,</pre></p>
<pre><code>#&apos;Referer&apos;: &apos;http://jxgl.cuit.edu.cn/Jxgl/Djks/Default.asp?Op=%B4%F3%D1%A7%D3%A2%D3%EF%B9%FA%BC%D2%C1%F9%BC%B6&apos;,
&apos;Accept-Encoding&apos;: &apos;gzip, deflate&apos;,
&apos;Accept-Language&apos;: &apos;zh-CN,en-US;q=0.8,en;q=0.6,zh;q=0.4&apos;
</code></pre><p>}</p>
<p>#用于查询的字段<br>sdata = {<br>    “func”:”login”,<br>    ‘Op’:’大学英语国家六级’.encode(‘GB2312’),<br>    ‘hdName’:’’,<br>    ‘HdXm’:”张龙”.encode(‘GB2312’),<br>    ‘TheTime’:20161217,<br>    ‘imageField22.x’:18,<br>    ‘imageField22.y’:13<br>}</p>
<p>#发送查询post请求<br>r = session.post(“<a href="http://jxgl.cuit.edu.cn/Jxgl/Djks/Default.asp&quot;" target="_blank" rel="noopener">http://jxgl.cuit.edu.cn/Jxgl/Djks/Default.asp&quot;</a>, data=sdata,headers=headerget)</p>
<p>#对结果进行再编码，这里是为了防止中文乱码<br>shtml = r.text.encode(r.encoding).decode(‘GB2312’,’ignore’)<br><br>最后，由于教务处查询后返回的是网页，而不是易于处理的结构化数据，所以，我们再用bs4匹配一次即可。（当存在同名学生的时候，查询条件会不止一条，这时候我们需要通过学号来限制（<a href="https://github.com/ankanch/data-analysis/tree/master/CUIT-%E8%AE%A1%E7%AE%97%E6%9C%BACET4%EF%BC%8C6%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2-%E5%88%86%E6%9E%90" target="_blank" rel="noopener">详细请参阅代码</a>）。）</p>
<h2 id="2-数据的储存"><a href="#2-数据的储存" class="headerlink" title="2.数据的储存"></a>2.数据的储存</h2><p>对于数据储存，由于一个学生可能考了多次四六级，故我采用了以下结构来储存数据：</p>
<p><div></div></p>
<blockquote>
<p><div>[学号,考号,姓名,班级,   [[成绩1：考试时间,类型,缺考,总分,听力,阅读,写作],[成绩2：考试时间,类型,总分,听力,阅读,写作]]   ]</div><br><br>示例：</p>
</blockquote>
<p><pre class="lang:python decode:true ">[<br>   201305103<em>,         #学号<br>   51006016220763</em>,    #考号<br>   学生姓名,<br>   计算机(工程)131,    #班级<br>   [   #成绩列表,list<br>       [‘20160618’, ‘大学英语国家四级’, ‘’, ‘439’, ‘195’, ‘109’, ‘135’],<br>       [‘20151219’, ‘大学英语国家四级’, ‘’, ‘419’, ‘134’, ‘156’, ‘129’],<br>       [‘20150613’, ‘大学英语国家四级’, ‘’, ‘383’, ‘147’, ‘119’, ‘117’],<br>       [‘20141220’, ‘大学英语国家四级’, ‘’, ‘341’, ‘134’, ‘90’, ‘117’],<br>       [‘20161217’, ‘大学英语国家六级’, ‘’, ‘278’, ‘112’, ‘128’, ‘38’]<br>]</pre><br>注意，在我们查询成绩完毕后，得到的数据结构如下：</p>
<blockquote>
<p>[姓名，考号，学号，姓名，性别，总分，缺考，违纪，听力，阅读，写作，综合]<br>以上数据结构是按照每一条成绩来储存的，故我们需要对该数据进行进一步处理，以生成我们所需要的按照学生存放的成绩列表。</p>
</blockquote>
<h2 id="3-数据的分析"><a href="#3-数据的分析" class="headerlink" title="3.数据的分析"></a>3.数据的分析</h2><h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><p>接下来，我们进入数据分析环节。在这里，为了便于跟踪，我们拿计算机学院2013级为例。</p>
<p>为什么要选2013级？</p>
<p>2013级目前大四，相当于每一年都有四六级成绩（如果考了六级）。数据量充足，且方便规律总结。</p>
<p>在从教务处下载计算机2013级名单且查询完毕四六级后，我们一共得到大概900条数据数据。（计算机学院2013级一共才200余人）。</p>
<p>接下来我们需要通过下面这个脚本生成上一节提到的按照学生存放的数据结构。</p>
<p><pre class="lang:python decode:true">import csv</pre></p>
<p>CET4 = “大学英语国家四级”<br>CET6 = “大学英语国家六级”</p>
<p>#加载记录集<br>stulist = []<br>f = open(‘result.csv’,’r’)<br>csvr = csv.reader(f)<br>for line in csvr:<br>    if len(line) &gt; 1:</p>
<pre><code>#print(line)
stulist.append(line)
</code></pre><p>f.close()<br>del stulist[0]<br>print(“数据总数：”,len(stulist))</p>
<p>#处理记录集<br>sidrl = []<br>stu46list = []  #储存每一次4，6级成绩的数据 [学号,考号,姓名,班级,[[成绩1：考试时间,类型,缺考,总分,听力,阅读,写作],[成绩2：考试时间,类型,总分,听力,阅读,写作]]<br>for stu in stulist:<br>    pid = stu[2]</p>
<pre><code>#首先找出一个学生的所有成绩
scl = [ x for x in stulist if x[2]==pid and pid not in sidrl ]
sidrl.append(pid)
if len(scl) &amp;lt;= 0:
    if stu[2] in sidrl:
        print(stu[3],&quot;已经处理，跳过;&quot;)
    else:
        print(stu[3],&quot;没有考试记录;&quot;)
else:
    print(scl[0][3],&quot;有&quot;,len(scl),&quot;条考试记录;&quot;,end=&apos;\t&apos;)
    cet4 = [ x for x in scl if x[11] == CET4 ]
    cet6 = [ x for x in scl if x[11] == CET6 ]
    print(&quot;其中有四级考试&quot;,len(cet4),&quot;次，六级考试&quot;,len(cet6),&quot;次.&quot;,end=&apos;\t&apos;)
    stucetinfo = [stu[2],stu[1],stu[3],stu[7],[  ]]
    #插入学生信息数组
    for exam in cet4:
        stucetinfo[4].append( [ exam[0],exam[11],exam[6],exam[5],exam[8],exam[9],exam[10] ]  )
    for exam in cet6:
        stucetinfo[4].append( [ exam[0],exam[11],exam[6],exam[5],exam[8],exam[9],exam[10] ]  )
    stu46list.append(stucetinfo)
</code></pre><p>print(“\n—\n原始数据:”,len(stulist),”条,独立学生数据：”,len(stu46list),”条”)</p>
<p>f = open(“csCET46list.csv”,”w”)<br>csvw = csv.writer(f)<br>csvw.writerows(stu46list)<br>f.close()<br><br>通过对成绩查询结果运行以上代码，我们已经生成了所需要的数据结构。</p>
<p>接下来我们对该结构数据进行分析。</p>
<h3 id="四级分析"><a href="#四级分析" class="headerlink" title="四级分析"></a>四级分析</h3><p>我们可以首先分析一下计算机学院2013级学生从开学到现在，每一次四级考试的成绩变化曲线。也就是说对比不同时间进行的四级考试的成绩变化。</p>
<p>我们只需要遍历每一个学生的成绩列表，将对应时间段的四级成绩放入对应时间段的四级成绩列表即可。为了让曲线图更加好看，我们去掉x轴的学生姓名，用编号代替，同时的绘图之前进行一次降序排序，这样变化趋势非常直观。</p>
<p>通过以下代码代码可以实现将每一名学生的四级成绩放到相应的时间段里：</p>
<p><pre class="lang:python decode:true"># [  [考试年份1,[ 成绩列表:考试时间,类型,缺考,总分,听力,阅读,写作 ]]， [考试年份2,[ 成绩列表:学生信息 ]],[考试年份3,[ 成绩列表:学生信息 ]],……   ]</pre></p>
<p>#其中 stulist为按照学生存放的成绩列表，exam_season为考试时间列表<br>CET4SCORE = []</p>
<p>#构造符合以上条件的结构体<br>for season in exam_season:<br>    CET4SCORE.append( [ season , [ y for x in stulist for y in x[4] if y[0] == season and y[1] == CET4 ].copy() ] )<br><br>接下来我们绘制图像，2013级四级变化曲线如下：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1.png" alt="figure_1"></a></p>
<p>wow，这个成绩变化简直惨不忍睹。上图中我绘制出了425分那条线（浅灰色那条）。</p>
<p>简单的讲就是，从2013级入学到现在，四级考试成绩基本上就一次比一次低。刚开学的时候考四级肯定是最高的，这是符合客观规律的。而且刚开学的时候不是所有人都可以考四级，故，在第二学期，也就是黄线，第二次四级考试人数达到了最高。</p>
<p>我们可以发现，随着四级考试次数的增多，缺考人数也在增加（成绩=0）。</p>
<p>从第三学期开始，2013级基本上全年级都开始进入懈怠状态，这和我们目前2015级的状态也一样。大学前两学期大家都斗志昂扬，基本上从第三学期开始，就有了显著的变化。那就是人越来越懒了。从四级成绩可以明显发现，同时从对<a href="https://github.com/ankanch/data-analysis/tree/master/CUIT-2017%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%BA%94%E7%94%A8%E6%88%90%E7%BB%A9%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90" target="_blank" rel="noopener">期末考试成绩的分析（查看计算机学院2015级第三学期期末分析）</a>也可以发现这一点。</p>
<p>还有一个有趣的情况就是，越到后面，上400都难，基本上大多数人都集中在300-&gt;400这个区间。</p>
<p>我们再进一步分析四级数据，我们可以绘制出每一年过级率变化曲线：</p>
<p>仍然借助于上面使用到的CET4SCORE变量，通过以下代码，即可将通过率以及最高成绩，最低成绩放入一个新的list中：</p>
<p><pre class="lang:python decode:true ">            caldata = [] #结构:[考试时间，通过率，最高分，最低分]<br>            for cet4 in CET4SCORE:</pre></p>
<pre><code>    #[考试年份1,[ 成绩列表:[考试时间,类型,缺考,总分,听力,阅读,写作] ]]
    #通过这个循环，将会得到每一次考试的通过率以及最高成绩，最低成绩
    passrate = str(round(len([x[3] for x in cet4[1] if int(x[3])&amp;gt;=425])/len(cet4[1])*100,2))+&quot;%&quot;
    maxs = max(cet4[1],key=lambda x:x[3])[3]
    rv = [x[3] for x in cet4[1] if x[3] != &quot;0&quot;]
    mins = min(rv)
    caldata.append([ cet4[0],passrate,maxs,mins ])
caldata.reverse()
print(caldata)&lt;/pre&gt;
</code></pre><p>再借助matplotlib，我们便有了下面两张图：</p>
<p>下面这张图是计算机学院2013级四级过级率的变化曲线（分数高于425的人数除以参考人数）</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-3.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-3.png" alt="figure_1-3"></a></p>
<p>上面这张图充分说明了考试通过率的变化，非常符合我对上张图的分析情况，大家都只有在第一二学期稍微认真一些，一旦大学的新鲜感一过，大家都开始惰散了。目测计算机学院2013级今年毕业的时候还是会有一大堆人还是没有能够通过四级考试。所以呢，我们学校的授位条件没有将425分作为最低条件真是个明智的选择。</p>
<p>接下来这张是四级考试最高分和最低分在历年考试中的变化曲线（最低分不包含0分）</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-4.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-4.png" alt="figure_1-4"></a>啧啧，我估计越到后面上500越难是因为英语成绩好的/会考试的基本在第一二学期都过了，剩下的在那里挣扎的都是英语不太好的。</p>
<h3 id="六级分析"><a href="#六级分析" class="headerlink" title="六级分析"></a>六级分析</h3><p>我们用同样的方法也可以得出2013级的六级成绩情况：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-1.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-1.png" alt="figure_1-1"></a></p>
<p>可以看出，六级成绩的每一年的总体变化是有很大的浮动的，我怀疑这和六级得分机制有关，不是说是什么相对分嘛。另外，不知道是不是2015年12月那次的六级特别难还是怎么的，通过的人数怎么那么少….</p>
<p>同样的，我们通过一样的方法得到历年计算机学院2013级的六级过级率情况</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-5.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-5.png" alt="figure_1-5"></a></p>
<p>六级仍然存在和四级一样的情况，越到后面过级率越来越低。原因肯定同上的啦。</p>
<p>接下来是最高分以及最低分情况</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-6.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-6.png" alt="figure_1-6"></a></p>
<p>可以发现，六级的最高分波动不大，最低分就不讲了。我认为，六级成绩波动不大的原因是，大家都过了四级，说明吧，理论上讲，在一定程度上英语基本（最基本的哦）能力还是有的，再加上做题的时候来一点小聪明，分数就上去了。。。</p>
<h3 id="计算机学院2013级，2014级，2015级同时期情况对比"><a href="#计算机学院2013级，2014级，2015级同时期情况对比" class="headerlink" title="计算机学院2013级，2014级，2015级同时期情况对比"></a>计算机学院2013级，2014级，2015级同时期情况对比</h3><p>以下对比了2013级，2014级，2015级，2016级第一次入学考试四级考试的通过率：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-1-2.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-1-2.png" alt="figure_1-1 (2)"></a></p>
<p>&nbsp;</p>
<p>从上面这张图来看，分布是挺正常的，2015级开始是一本招生（在四川）而一大部分学生都来自四川，故2015级和之后的2016级通过率都非常高。之前的2013级和2014级通过率在当时看来，也都处于一个正常水平。</p>
<p>接下来是这几个年级平均分，最高分，最低分情况：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-2.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-2.png" alt="figure_1"></a></p>
<p>上图为包含0分的平均分，下图为不包含0分的平均分：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/figure_1-1_exce0.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/figure_1-1_exce0.png" alt="figure_1-1_exce0"></a></p>
<p>难以置信，居然，2013级的平均分那么高。怀疑那时候是不是考四级不要求高考英语必须多少分嘛。</p>
<p>看最高分，挺正常的，因为2016级也是一本招生，且高考平均分比我们2015级还高一些，所以，英语最高分高也挺正常的。不过吧，2014，2015，2016级的平均分全都没超过425…..然而通过率却高达69%，说明蛮多的人是挂线过的。</p>
<h3 id="单独分析2015级的数据"><a href="#单独分析2015级的数据" class="headerlink" title="单独分析2015级的数据"></a>单独分析2015级的数据</h3><p>下面是计算机学院2015级的四六级成绩变化情况：简单地讲，就是越到后面越不容易通过。上500也就更难了（至少在我们学校。）</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/2015级3次六级成绩变化图.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/2015级3次六级成绩变化图.png" alt="2015级3次六级成绩变化图"></a></p>
<p>&nbsp;</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/03/2015级3次四级成绩变化图.png"><img src="http://akakanch.com/wp-content/uploads/2017/03/2015级3次四级成绩变化图.png" alt="2015级3次四级成绩变化图"></a></p>
<p>(完)</p>
<h2 id="4-其它"><a href="#4-其它" class="headerlink" title="4.其它"></a>4.其它</h2><h6 id="总结一下哈，那就是我们学院我觉得，起码90-的人真的不知道自己应该干嘛。"><a href="#总结一下哈，那就是我们学院我觉得，起码90-的人真的不知道自己应该干嘛。" class="headerlink" title="总结一下哈，那就是我们学院我觉得，起码90%的人真的不知道自己应该干嘛。"></a>总结一下哈，那就是我们学院我觉得，起码90%的人真的不知道自己应该干嘛。</h6><p>这篇文章就当是拿到那些数据练练手外加提升自己一点小能力了。</p>
<p>不知道有没有看客可以洞察出更深层的结论来。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2017/01/16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/16/" itemprop="url">Python转换字符串字典为Python字典类型数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-16T22:48:25+08:00">
                2017-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>假设我们有一下字符串：</p>
<p><pre class="lang:python decode:true ">stra = “{‘muffin’ : ‘lolz’, ‘foo’ : ‘kitty’}”</pre><br>可以看到这个字符串非常像python的字典类型，我们期望把它转换为字典类型，然后方便我们读取数据。</p>
<p>大家知道可以通过 eval 函数转换，但是有一种更加安全的方法，那就是literal_eval</p>
<p>如下：</p>
<p><pre class="lang:python decode:true ">import ast<br>stra = “{‘muffin’ : ‘lolz’, ‘foo’ : ‘kitty’}”<br>ast.literal_eval(stra)<br></pre><br>literal_eval的介绍如下：</p>
<p><pre class="lang:python decode:true ">&gt;&gt;&gt; help(ast.literal_eval)<br>Help on function literal_eval in module ast:</pre></p>
<p>literal_eval(node_or_string)<br>    Safely evaluate an expression node or a string containing a Python<br>    expression.  The string or node provided may only consist of the following<br>    Python literal structures: strings, numbers, tuples, lists, dicts, booleans,<br>    and None.<br>给出使用eval和 literal_eval转换时候的出错比较：</p>
<p><pre class="lang:sh decode:true ">&gt;&gt;&gt; eval(“shutil.rmtree(‘mongo’)”)<br>Traceback (most recent call last):<br>  File “&lt;stdin&gt;”, line 1, in &lt;module&gt;<br>  File “&lt;string&gt;”, line 1, in &lt;module&gt;<br>  File “/opt/Python-2.6.1/lib/python2.6/shutil.py”, line 208, in rmtree<br>    onerror(os.listdir, path, sys.exc_info())<br>  File “/opt/Python-2.6.1/lib/python2.6/shutil.py”, line 206, in rmtree<br>    names = os.listdir(path)<br>OSError: [Errno 2] No such file or directory: ‘mongo’<br>&gt;&gt;&gt; ast.literal_eval(“shutil.rmtree(‘mongo’)”)<br>Traceback (most recent call last):<br>  File “&lt;stdin&gt;”, line 1, in &lt;module&gt;<br>  File “/opt/Python-2.6.1/lib/python2.6/ast.py”, line 68, in literal_eval<br>    return _convert(node_or_string)<br>  File “/opt/Python-2.6.1/lib/python2.6/ast.py”, line 67, in _convert<br>    raise ValueError(‘malformed string’)<br>ValueError: malformed string</pre><br>可以看出 literal_eval 比 eval安全得多</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2017/01/14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/01/14/" itemprop="url">Windows下使用命令安装Python的scipy库出错的解决方案</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-14T15:39:37+08:00">
                2017-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在准备GSoC2017的时候一个项目需要用到Scipy库。</p>
<p>本来以为非常简单的事情，结果我硬是弄了10多分钟才解决。</p>
<p>正常来讲，安装一个python的库只需要通过一下命令即可：</p>
<p><pre class="lang:sh decode:true ">pip install package-name</pre><br>于是看到需要用到scipy库后我做的第一件事情就是使用以上命令尝试安装，然后不幸的是，报错了。</p>
<p>错误如下图：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2017/01/QQ截图20170114112205.jpg"><img src="http://akakanch.com/wp-content/uploads/2017/01/QQ截图20170114112205.jpg" alt="QQ截图20170114112205"></a></p>
<p>最开始以为是以为我python2和python3共存的缘故导致安装失败，可后面发现貌似并不是这样的。</p>
<p>在网络上搜索一番后，虽然没有找到财务原因，但是找到了如何解决这个错误。</p>
<p>解决方法如下：</p>
<p>下载scipy对应的whl包，如何通过pip直接安装whl包，而不是在pypi索引去搜索下载。</p>
<p>有一个网站，它的介绍如下：</p>
<p><pre class="">This page provides 32- and 64-bit Windows binaries of many scientific open-source extension packages for the official <a href="http://www.python.org/download/" target="_blank" rel="noopener">CPython distribution</a> of the <a href="http://www.python.org/" target="_blank" rel="noopener">Python</a> programming language.</pre><br>这个网站提供了windows下几乎所有python的科学计算库：</p>
<p><strong><a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="noopener">http://www.lfd.uci.edu/~gohlke/pythonlibs/</a></strong></p>
<p>在上面那个网站找到对应的python版本下载，如何再用一下命令安装即可：</p>
<p><strong>查看你的python的32位还是64位直接在命令行输入python即可。</strong></p>
<p><pre class="lang:sh decode:true">pip install package-name.whl</pre><br><strong>在安装scipy的过程中还有可能会遇到MemoryError</strong>，这种情况是由于内存不够，关点软件就行了。我之前在Ubuntu安装Scipy就遇到了该错误，，当时内存大概有600MB剩余，，，关了一个软件变成700MB剩余后解决了该问题。</p>
<p>===================</p>
<p>如果你不是windows，一切都要好办多了，基本上劝都可以通过pip install 命令来安装。</p>
<p><a href="http://blog.csdn.net/u011177305/article/details/52334023" target="_blank" rel="noopener">参考：http://blog.csdn.net/u011177305/article/details/52334023</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/12/06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/06/" itemprop="url">Python Flask Google App Engine允许Access-Control-Allow-Origin跨域访问</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-06T10:32:35+08:00">
                2016-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/" itemprop="url" rel="index">
                    <span itemprop="name">C++ / Visual C++</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/Linux-Unix-虚拟主机-VPS/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/Linux-Unix-虚拟主机-VPS/Python/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在做一个纯API接口，部署到Google App Engine上面（为了利用GAE的负载均衡，减少服务器压力）。</p>
<p>最后在另外一台服务器上调用的时候，却无法正确获取数据，提示错误如下：</p>
<p><strong><span style="color: #ff0000;">XMLHttpRequest cannot load ‘&lt;some-url&gt;’. No ‘Access-Control-Allow-Origin’ header is present on the requested resource. Origin ‘&lt;my-url&gt;’ is therefore not allowed access.</span></strong></p>
<p>经过搜索发现是因为跨域调用问题（即从一个域名请求另外一个域名下的信息，至少在Chrome中是禁止的）</p>
<p>解决该问题的方法如错误提示信息所示，在服务器端的response加入Access-Control-Allow-Origin即可。</p>
<p>网上查出来的很多方法都是通过在GAE的app.yaml文件里面添加来实现的，后面我尝试后发现不管用。</p>
<p>于是经过一番搜索，搜索出了这个：<a href="http://flask.pocoo.org/snippets/56/" target="_blank" rel="noopener">Decorator for the HTTP Access Control</a></p>
<p>为Flask写一个访问修饰器，然后，通过在要控制Access-Control的路由函数前面添加@crossdomain(origin=’*’)来实现发送Access-Control-Allow-Origin头。</p>
<p>首先，我们定义一个如下函数（这个函数内部还有函数哦）：</p>
<p><pre class="lang:python decode:true ">from datetime import timedelta<br>from flask import make_response, request, current_app<br>from functools import update_wrapper</pre></p>
<p>def crossdomain(origin=None, methods=None, headers=None,<br>                max_age=21600, attach_to_all=True,<br>                automatic_options=True):<br>    if methods is not None:<br>        methods = ‘, ‘.join(sorted(x.upper() for x in methods))<br>    if headers is not None and not isinstance(headers, basestring):<br>        headers = ‘, ‘.join(x.upper() for x in headers)<br>    if not isinstance(origin, basestring):<br>        origin = ‘, ‘.join(origin)<br>    if isinstance(max_age, timedelta):<br>        max_age = max_age.total_seconds()</p>
<pre><code>def get_methods():
    if methods is not None:
        return methods

    options_resp = current_app.make_default_options_response()
    return options_resp.headers[&apos;allow&apos;]

def decorator(f):
    def wrapped_function(*args, **kwargs):
        if automatic_options and request.method == &apos;OPTIONS&apos;:
            resp = current_app.make_default_options_response()
        else:
            resp = make_response(f(*args, **kwargs))
        if not attach_to_all and request.method != &apos;OPTIONS&apos;:
            return resp

        h = resp.headers

        h[&apos;Access-Control-Allow-Origin&apos;] = origin
        h[&apos;Access-Control-Allow-Methods&apos;] = get_methods()
        h[&apos;Access-Control-Max-Age&apos;] = str(max_age)
        if headers is not None:
            h[&apos;Access-Control-Allow-Headers&apos;] = headers
        return resp

    f.provide_automatic_options = False
    return update_wrapper(wrapped_function, f)
return decorator&lt;/pre&gt;
</code></pre><p>接着，我们只需要在我们要加入Access-Control-Allow-Origin头的位置添加下面这一句即可：</p>
<p><pre class="lang:python decode:true ">#<br>#<br>@crossdomain(origin=’<em>‘)   # &lt;-添加这句，可以把</em>改为想要允许的域名</pre></p>
<p>#<br>#<br>@app.route(‘/my_service’)<br>@crossdomain(origin=’*’)   #这货的添加位置应该在路由之后<br>def my_service():</p>
<pre><code>#do something&lt;/pre&gt;
</code></pre><p>然后，我们再次调用API，就会发现，没有报这个错误了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/12/04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/04/" itemprop="url">Google App Enigne Python文件读写</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-04T11:05:43+08:00">
                2016-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/Python/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp;</p>
<p><strong>&lt;转载请注明来源&gt;</strong></p>
<p>之前在google app enigne上面搭建了一个用来抓取学校新闻的网站（<a href="https://forcuit-151103.appspot.com/news_xueshu" target="_blank" rel="noopener">各种学术讲座预告新闻</a>），还可以通过邮件提醒学校新闻的更新。</p>
<p>因为要记录增量更新的新闻，所以需要将新闻缓存在文件里面（数据库也可以，但考虑到GAE免费版只支持python2，所以还是用文件缓存吧）</p>
<p>当时学python的时候（点我<a href="http://www.cnblogs.com/vamei/archive/2012/09/13/2682778.html" target="_blank" rel="noopener">30分钟快速入门</a>）直接学的python3的语法，python2和python3有许多的不同(<a href="http://sebastianraschka.com/Articles/2014_python_2_3_key_diff.html" target="_blank" rel="noopener">点我参考不同之处</a>)</p>
<p>当然python3写的程序，也可以方便的通过<a href="https://pypi.python.org/pypi/3to2/1.1.1" target="_blank" rel="noopener"><strong>3to2</strong></a>转换得到相应的python2版本。</p>
<p>通过以下命令，3to2可以将指定python3文件或路径里的所有python3文件转换为python2的语法：</p>
<p><pre class="lang:python decode:true ">#</pre></p>
<p>#file 为文件或者文件夹<br>python3 3to2.py -w [file]<br><br>当时以为只需要简单的将文件操作转换为python2的即可，结果部署到GAE后发现，并不能写入，更别说读取了。</p>
<p>后面在GAE的控制台看错误信息，发现并没有相关错误提示。故Google之(<a href="https://www.google.com.hk/search?newwindow=1&amp;safe=strict&amp;q=google+app+engine+python+read+file&amp;oq=Google+App+Engine+&amp;gs_l=serp.3.0.35i39k1j0l9.199.3152.0.4575.12.12.0.0.0.0.344.1898.0j6j2j1.9.0....0...1c.1.64.serp..3.9.1898...0i20k1.cSDLSUneB4s" target="_blank" rel="noopener">google app engine python read file</a>)…</p>
<hr>
<p>&nbsp;</p>
<p>后面找到了这个：<a href="https://cloud.google.com/appengine/docs/python/googlecloudstorageclient/read-write-to-cloud-storage" target="_blank" rel="noopener">Reading and Writing to Google Cloud Storage</a></p>
<p>再搜索了一下Google Cloud Storage，发现GAE的应用如果要使用文件都需要在这个上面进行。<br>于是以为只需要简单的通过 pip install cloudstorage 即可，因为谷歌给出的示例代码是直接 import cloudstorage 的。</p>
<p>结果事实证明并不行。接下来当然又要借助万能的谷歌了，搜索how toinstall python google cloud storage 。最后得到了这个：<a href="http://stackoverflow.com/questions/25100031/install-python-google-cloud-storage-client-on-ubuntu-14-04" target="_blank" rel="noopener">install python google cloud storage client on Ubuntu 14.04</a></p>
<p>虽然是Ubuntu的，但还是凑合着用吧。通过那个网站我们知道Google Cloud Storage的正确的包名为：</p>
<p><strong>GoogleAppEngineCloudStorageClient</strong></p>
<p>接下来就简单了，直接pip安装，不过还要<a href="http://akakanch.com/archives/634">结合之前那篇文章的方法</a>，将那货安装到应用的lib目录，否则，部署到GAE后会提示找不到module！</p>
<p><pre class="lang:sh decode:true ">#</pre></p>
<p>#假设该命令运行目录为你应用的根目录（即可见lib文件夹的目录）</p>
<p>pip install GoogleAppEngineCloudStorageClient -t lib</p>
<p>#</p>
<p>#如果你同时安装了python2和python3，请使用以下命令：</p>
<p>py -2 -m pip install GoogleAppEngineCloudStorageClient -t lib<br>到这里，我们已经完成了必要模块的安装，接下来开始敲代码了。</p>
<p>还是参考google的文档：<a href="https://cloud.google.com/appengine/docs/python/googlecloudstorageclient/read-write-to-cloud-storage" target="_blank" rel="noopener">Reading and Writing to Google Cloud Storage</a></p>
<p>首先import一些必要库：</p>
<p><pre class="lang:python decode:true ">#<br>#<br>import logging<br>import os<br>import cloudstorage as gcs<br>import webapp2</pre></p>
<p>from google.appengine.api import app_identity<br>google在文档中说明，所有的文件操作都在一个叫做bucket的东西里面进行的，bucket是可以扩充的，当然，免费版只有5GB而且是所有你账户下免费GAE应用共享的，不过对于部署GAE应用来说，足够了（毕竟google通过GAE赚不了什么钱。）</p>
<p>所以，bucket这里我们直接使用默认的即可，通过以下代码获取默认bucket路径，所有的文件都会存放在这个路径下：</p>
<p><pre class="lang:python decode:true">#</pre></p>
<p>#RetryParams是说明文件读写超时时间，这里直接使用了google默认的</p>
<p>#cachepath即为我们要存放文件的路径，直接cachepath+filename即可<br>bucket_name = os.environ.get(‘BUCKET_NAME’,app_identity.get_default_gcs_bucket_name())<br>write_retry_params = gcs.RetryParams(backoff_factor=1.1)<br>cachepath = ‘/‘ + bucket_name +’/‘<br>接下来讲读写文件操作：</p>
<p>文件读写同样主要用到open(),read(),write(),不过，这些函数是cloudstorage里面的。</p>
<p>详细的函数说明可以参考google官方文档：<a href="https://cloud.google.com/appengine/docs/python/googlecloudstorageclient/functions#open" target="_blank" rel="noopener"><strong>Google Cloud Storage Client Library Functions</strong></a></p>
<p>下面是一个写文件的例子：</p>
<p><pre class="lang:python decode:true">#</pre></p>
<p>#写文件操作主要在try块里面，google的代码没有try块，不过为了防止操作失败，建议还是加上<br>def refreshCache(data,cachefilename):<br>    try:<br>        gcs_file = gcs.open(cachepath+cachefilename,     #文件名（要加上路径，否则会出错）<br>                      ‘w’,                               #要执行的操作类型，这里是写操作，默认为读操作<br>                      content_type=’text/plain’,         #指定要以何种方式写入文件（仅在操作类型为w的时候有效）</p>
<pre><code>                                                     #默认是以二进制方式写入，这里我们使用纯文本
                  retry_params=write_retry_params)   #超时设置
    gcs_file.write(data)
    gcs_file.close()
except Exception as e:
    return &quot;CACHE ERROR：refresh &amp;lt;br/&amp;gt;please contact kanch@akakanch.com&amp;lt;hr/&amp;gt;&quot;
return &quot;OK&amp;lt;hr/&amp;gt;&quot;&lt;/pre&gt;
</code></pre><p>上面的注释已经简要的说明了各个必要参数的意思。</p>
<p>接下来是一个读取文件的例子：</p>
<p><pre class="lang:python decode:true ">#</pre></p>
<p>#同样的读取文件的代码主要在try块里面<br>def checkNewNews(newsdata,cachefilename):<br>    sourcedata = “”<br>    newslist = newsdata<br>    try:<br>        gcs_file = gcs.open(cachepath+cachefilename,<br>                      retry_params=write_retry_params)<br>        sourcedata = gcs_file.read()<br>        gcs_file.close()<br>    except Exception as e:<br>        return “CACHE ERROR：check &lt;br/&gt;please contact <a href="mailto:kanch@akakanch.com">kanch@akakanch.com</a>&lt;hr/&gt;”<br>    return newupdate<br>可以看到，我们没有指定打开模式，所以函数使用了默认打开方式，即读取文件模式。</p>
<p>最后就是简单的read()出来进行处理了。</p>
<hr>
<p>再来简单的说下Google App Engine吧，每个google帐号可以有10个免费GAE资源。不过中文资料太难找，部署起来还是算比较麻烦的，不过免费的，大家都喜欢。。。</p>
<p>GAE允许的每个响应的最长响应时间为60秒，如果60秒操作还没结束，就会被GAE管理杀掉，然后报错。。。。所以大家千万不要执行一些耗时长的操作，否则<del>~</del></p>
<p>GAE对于一些小的应用来说足够了，唯一的缺点是python只支持python2，支持python3的为Flexiable版（收费）。</p>
<p>GAE在国内是无法访问的，不过国内有牛人做了一个反向代理，只需要简单的改变下GAE App的地址即可：</p>
<p>比如，源地址：<a href="https://forcuit-151103.appspot.com/" target="_blank" rel="noopener">https://forcuit-151103.appspot.com/</a></p>
<p>改为：<a href="https://forcuit-151103.appsp0t.com/" target="_blank" rel="noopener"> https://forcuit-151103.appsp0t.com/ </a>即可在国内正常访问。（只是把appsopt改为了appsp0t哈哈哈哈）。另外，大家也可以通过反向代理的方式来让国内可访问GAE。</p>
<p>&nbsp;</p>
<p><strong>&lt;转载请注明来源&gt;</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Kanch</p>
              <p class="site-description motion-element" itemprop="description">personal blog of Long Zhang (kanchisme@gmail.com)</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">Kategorien</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">282</span>
                  <span class="site-state-item-name">Tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kanch</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
