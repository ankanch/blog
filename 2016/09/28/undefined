<html>
    <!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	

	<title>不到20行简单Python代码获取有道翻译的翻译结果 | akakanch</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	<link rel="shortcut icon" href="/favicon.ico">	
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/caomei.css">
	<link rel="stylesheet" href="/css/style.css">
	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

    <body>
        <div class="root">
            <div class='topnavs container fixed-690'>
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            首页
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/categories">
                            分类
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/archives">
                            归档
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/tags">
                            标签
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/about">
                            关于
                        </a>
                    </li>
                    
            </ul>
        </div>
    </nav>
</div>
                <section class="container mainbody fixed-690">
                    <div class="post">
    <div class="post-title">
        <h1>
            不到20行简单Python代码获取有道翻译的翻译结果 
        </h1>

        
        <div class="post-title-views">
            <span id="busuanzi_container_page_pv">
                本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
            </span>
        </div>
        
    </div>
    <div class="post-content markdown">
        <p>Python真是一个牛逼的脚本语言。</p>
<p>接下来我来谈谈这个小程序，一个不到20行核心代码的小程序，用户输入对应的英文字母，我们返回相应的中文翻译，当然，中文翻译来自有道翻译。</p>
<p>接下来进入正题。</p>
<p>简单的讲，获取翻译结果就是将目标网页下载下来，然后进行字符串匹配，从网页源代码中匹配出翻译结果就行。</p>
<p>如下图所示：</p>
<p><a href="http://115.159.197.66/wp-content/uploads/2016/09/QQ图片20160906154407-1.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/09/QQ图片20160906154407-1-1024x576.png" alt=""></a></p>
<p>我们首先打开有道翻译，然后随便翻译点什么，然后，观察url的变化，因为之后我们需要通过这个url来构造我们的翻译查询url：</p>
<p><pre class="lang:python decode:true">query_url=”<a href="http://fanyi.youdao.com/translate?ue=utf-8&amp;keyfrom=baidu&amp;smartresult=dict&amp;type=EN2ZH_CN&amp;i=&quot;" target="_blank" rel="noopener">http://fanyi.youdao.com/translate?ue=utf-8&amp;keyfrom=baidu&amp;smartresult=dict&amp;type=EN2ZH_CN&amp;i=&quot;</a> + word    #word是要翻译的单词</pre><br>然后，我们再看对应的网页源代码，我们可以看到，有道翻译的翻译结果是直接显示在网页源代码里面的，所以，接下来我们需要做的就是，观察翻译结果周围的字符串，看看有什么特点，这里指的是翻译结果周围的字符串应该足够奇葩，保证，网页源代码里面只有一个。</p>
<p>比如我可以看到，这串翻译结果，前面的字符串是 “tgt”:” 后面的是”}]],，简直奇葩，可以保证只有一个。</p>
<p>所以，整个流程应该是：</p>
<p>构造翻译url -&gt; 下载对应的网页 -&gt; 从对应的网页里匹配出字符串</p>
<p>下载网页，我们可以通过urllib的urlopen和read实现。</p>
<p><pre class="lang:python decode:true">page = urllib.request.urlopen(url,timeout=5)<br>html = page.read()<br>html = getHtml(url)<br>html = html.decode(‘utf-8’,’ignore’)   #解码，一定要加上ignore标签，否则可能会出错</pre><br>匹配字符串，我们只需要find对应首尾字符串，然后提取子串即可</p>
<p><pre class="lang:python decode:true">head = “\”tgt\”:\””<br>tail = “\”}]],”<br>start = html.find(head)<br>end = html.find(tail,start)<br>result1 = html[start+len(head):end]</pre><br>所以最终代码下：</p>
<p>如果只提取一个中文意思，且不包括其它附加信息的话，核心代码就只有10行。</p>
<p>所以呢，python简直太6666</p>
<p><pre class="lang:python decode:true">#coding=utf-8<br>import urllib.request<br>import urllib.parse<br>import re</pre></p>
<p>query_url=”<a href="http://fanyi.youdao.com/translate?ue=utf-8&amp;keyfrom=baidu&amp;smartresult=dict&amp;type=EN2ZH_CN&amp;i=&quot;" target="_blank" rel="noopener">http://fanyi.youdao.com/translate?ue=utf-8&amp;keyfrom=baidu&amp;smartresult=dict&amp;type=EN2ZH_CN&amp;i=&quot;</a></p>
<p>def getHtml(url):<br>    page = urllib.request.urlopen(url,timeout=5)<br>    html = page.read()<br>    return html</p>
<p>def getTranslate(word,query_url):</p>
<pre><code>#url = query_url + urllib.parse.urlparse(word)
url = query_url + word
html = getHtml(url)
html = html.decode(&apos;utf-8&apos;,&apos;ignore&apos;)
#寻找翻译结果
head = &quot;\&quot;tgt\&quot;:\&quot;&quot;
tail = &quot;\&quot;}]],&quot;
start = html.find(head)
end = html.find(tail,start)
result1 = html[start+len(head):end]
#寻找附加结果
head =&quot;[\&quot;\&quot;,\&quot;&quot;
tail =&quot;\&quot;]}};&quot;
start = html.find(head)
end = html.find(tail,start)
result2 = html[start+len(head):end]
print(&apos;\r\n\r\n&apos;,word,&apos;\r\n&apos;,result1,&apos;\r\n&apos;,result2,&apos;\r\n\r\n\r\n&apos;)
</code></pre><p>word = “11111”<br>while(word != “EEXXIITT”):<br>    word = input(“enter a word(ENGLISH -&gt; CHINESE) : <strong><strong><strong><strong>_</strong></strong></strong></strong>\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b”)<br>    getTranslate(word,query_url)<br>运行结果：</p>
<p><a href="http://115.159.197.66/wp-content/uploads/2016/09/IMG20160918211121.jpg" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/09/IMG20160918211121-1024x458.jpg" alt="img20160918211121"></a></p>
 
    </div>
    <div class="post-foot">
        <div id="disqus_thread"></div>
    </div>
</div>


                </section>
                <footer class="container fixed-690 footer">
    <div>
        <span>Power by <a href="https://hexo.io">Hexo</a></span>
    </div>
    <div>
        <span>Theme <a href="https://github.com/zhengxiaowai/hexo-theme-lessless">lessless</a></span>
    </div>
        
            
<div>
    <span id="hexiangyutest_container_site_pv">
    PV: <span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv">
    UV: <span id="busuanzi_value_site_uv"></span>
    </span>
</div>

        
</footer>
        </div>
        
<script src="/js/jquery-3.2.1.slim.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


    

    </body>
</html>