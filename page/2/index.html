<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="personal blog of Long Zhang (kanchisme@gmail.com)">
<meta property="og:type" content="website">
<meta property="og:title" content="akakanch">
<meta property="og:url" content="http://akakanch.com/page/2/index.html">
<meta property="og:site_name" content="akakanch">
<meta property="og:description" content="personal blog of Long Zhang (kanchisme@gmail.com)">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="akakanch">
<meta name="twitter:description" content="personal blog of Long Zhang (kanchisme@gmail.com)">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://akakanch.com/page/2/"/>





  <title>akakanch</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">akakanch</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            Über
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/11/30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/30/" itemprop="url">Windows下python2和python3共存且随时切换</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-30T22:50:23+08:00">
                2016-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在使用Google App Engine，然后自己准备部署个python爬虫部署在GAE上面，然后开始跟着谷歌的教程创建hello world程序。完毕后，想到，自己只需要稍微修改下谷歌的代码，然后在默认的main.py里面添加路由，调用自己的函数即可。</p>
<p>当然要修改代码，必须得先下载代码才行，但是谷歌给出的脚本为python2的脚本，并没有python3的脚本。虽然我们已经知道通过<a href="https://wiki.python.org/moin/3to2" target="_blank" rel="noopener">3to2</a>可以转换python3代码到python2。但是这是不得已才会使用的方法，所以最好的办法仍然是使用python2来运行。</p>
<p>那么，就需要python2和python3在windows上共存了。</p>
<p>（修改exe程序名字是可以实现的，但是这样的话，pip就会出错。）</p>
<p>不过，后面在python官网上找到了解决方案</p>
<p>实现，我们需要安装python2（安装完毕后不要加入到PATH里面。）</p>
<p>然后python3内置了py.exe 通过这个程序，我们可以选择使用哪个python版本来运行脚本</p>
<p>下面的代码展示了分别用python2和python3运行脚本：</p>
<p><pre class="lang:python decode:true">#使用python2运行h.py<br>py -2 k.py</pre></p>
<p>#使用python3运行h.py<br>py -3 k.py<br><br>如果觉得这样太麻烦，可以通过在源代码文件第一行添加：</p>
<p><pre class="lang:python decode:true ">#! python3</pre><br>或者</p>
<p><pre class="lang:python decode:true ">#! python2</pre><br>来指明使用哪个版本的python运行脚本</p>
<p>然后我们只需要：</p>
<p><pre class="lang:sh decode:true ">py h.py</pre><br>py.exe就会自动根据我们在文件第一行指明版本的python解释器来运行h.py</p>
<p>关于不同版本之间pip的使用：</p>
<p>使用如下命令即可运行指定版本的pip：</p>
<p><pre class="lang:sh decode:true">py -2 -m pip install XXX</pre></p>
<p>py -3 -m pip install XXX<br>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/11/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/27/" itemprop="url">matplotlib饼状图(pie)不能正确显示中文的解决办法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-27T16:15:02+08:00">
                2016-11-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>还是之前那个<a href="https://github.com/ankanch/tieba-zhuaqu" target="_blank" rel="noopener">tieba-zhuaqu</a>项目，在使用matplotlib绘制饼状图（pie）的时候，发现不能显示中文。</p>
<p><a href="http://akakanch.com/wp-content/uploads/2016/11/1480233742985screencapture.png"><img src="http://akakanch.com/wp-content/uploads/2016/11/1480233742985screencapture.png" alt="1480233742985screencapture"></a></p>
<p>（<a href="https://my.oschina.net/Kanonpy/blog/617535?p=1" target="_blank" rel="noopener">图片源地址：https://my.oschina.net/Kanonpy/blog/617535?p=1</a>）</p>
<p>之前使用matplotlib绘制其它类型的图片的时候也发现不能显示中文，最后的解决办法都是使用FontProperties() 来设置字体解决问题。</p>
<p>然而发现饼状图貌似不不能简单的通过在plt.pie（）中传入FontProperties() 解决中文乱码的问题。</p>
<p>后面在<a href="https://my.oschina.net/Kanonpy/blog/617535?p=1" target="_blank" rel="noopener">https://my.oschina.net/Kanonpy/blog/617535?p=1</a>找到了解决办法，以及出现这个问题的原因。</p>
<p>在调用pie()函数的时候，它会返回字体对象。而且返回的字体对象不支持中文字体。</p>
<p>根据那篇文章里的说法，我们只需要修改pie（）返回的字体对象即可，即将它返回的对象修改为支持中文的字体。</p>
<p><pre class="lang:python decode:true ">patches,l_text,p_text = plt.pie(ValueList, labels=Labels, colors=colors,autopct=’%1.1f%%’,explode=explode ,shadow=True, startangle=90)<br>    for font in l_text:<br>        font.set_fontproperties(FontProperties(fname=PATH_SUFFIX+’SIMLI.TTF’))<br>    plt.title(graphicTitle,fontproperties=font_set,y=1.05)</pre><br>上面的代码中，我把字体拷贝到了和脚本同一个目录，PATH_SUFFIX为脚本当前目录，可以通过以下方式获得：</p>
<p><pre class="lang:python decode:true ">#重要全局变量<br>PATH_SUFFIX = os.path.abspath(os.path.join(os.path.dirname(<strong>file</strong>), os.pardir, os.pardir))<br>PATH_SUFFIX+=”\userX\“   #插件根目录</pre><br>这样做的好处就是，把脚本拷贝给其他人的时候，也可以保证饼状图可以正常显示中文字体。</p>
<p>这样，我们便可以正常显示中文字体了。</p>
<p><a href="http://akakanch.com/wp-content/uploads/2016/11/用户维度数据分析-互动密切用户（异常）.png"><img src="http://akakanch.com/wp-content/uploads/2016/11/用户维度数据分析-互动密切用户（异常）.png" alt="用户维度数据分析-互动密切用户（异常）"></a></p>
<p>关于在哪里寻找字体：</p>
<p>windows下字体路径：</p>
<p><strong>C:\Windows\Fonts</strong></p>
<p>Ubuntu下字体路径：</p>
<p><strong>/usr/share/fonts</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/11/14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/14/" itemprop="url">MFC利用CFileFind枚举目录下所有文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-14T18:32:47+08:00">
                2016-11-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/" itemprop="url" rel="index">
                    <span itemprop="name">C++ / Visual C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在写<a href="https://github.com/ankanch/tieba-zhuaqu" target="_blank" rel="noopener">贴吧分布式爬虫系统（https://github.com/ankanch/tieba-zhuaqu）</a>的用户管理端程序。为了保证高度可扩展性，在该程序的数据分析部分，引入了插件机制。这样日后需要拓展功能的时候只需要不断的增加插件（由于插件是python写的，所以我们只需要用C++调用cmd执行python插件就行。如果需要UI，也可以使用python自带的Tkinter实现。）</p>
<p>这样，便通过C++与python结合的方式，完成了用户管理端程序。</p>
<p>该程序所引入的插件机制非常简单，因为插件是用python脚本完成的，所以我们只需要让我们的C++程序找到python脚本，并且执行即可。</p>
<p>这样就涉及到一个问题，那就是如何令MFC程序列举出当前一个子目录下的所有文件。一旦实现这个，我们基本也就完成了插件的加载功能。</p>
<p>还是上网查，查如何解决，在试了一系列的方法后，找到了一个叫做<a href="https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile" target="_blank" rel="noopener">CFileFind类</a>。然后去MSDN查这个类的用法，我们可以发现，MSDN指出：</p>
<p><pre class="">执行本地文件搜索和是 CGopherFileFind 和 CFtpFileFind的基类，执行Internet文件搜索。</pre><br>只有一句话，重点是，它可以执行本地文件搜索，比那些Windows API好用多了。</p>
<p>接下来我们讲讲如何使用这个类，从MSDN查询我们可以发现，我们主要需要以下几个函数：</p>
<p><table summary="table"></table></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::Close</td></p>
<p><td data-th="说明">关闭搜索请求。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::FindFile</td></p>
<p><td data-th="说明">搜索一个目录一个指定的文件名。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::FindNextFile</td></p>
<p><td data-th="说明">继续以前的文件搜索调用 FindFile。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称"></td></p>
<p><td data-th="说明"></td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::GetFileName</td></p>
<p><td data-th="说明">获取名称，包括扩展，找到的文件</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::IsDirectory</td></p>
<p><td data-th="说明">确定找到的文件是否为内容。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::IsDots</td></p>
<p><td data-th="说明">确定找到的文件的名称是否具有名称“”。或者“。”，指示实际上是内容。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称"></td></p>
<p><td data-th="说明"></td><br><br><br><br><a href="https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile" target="_blank" rel="noopener">（内容来源：MSDN：https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile）</a></p>
<p>那么如何搜索呢？</p>
<p>根据MSDN上的例子，我们在第一次查找的时候，首先需要给其传入一个路径，指明在哪里查找该文件。</p>
<p><pre class="lang:c++ decode:true ">//下面的代码传入当前exe文件同目录下的plugins文件夹路径-&gt;kanch<br>CFileFind finder;<br>BOOL bWorking = finder.FindFile(_T(“.\plugins\<em>.</em>“));</pre><br>然后，我们只需要循环调用FindNextFile()，并判断其返回值是否为false即可。（当为false时，表示已经遍历完当前目录下所有文件，或者出错。如果出错，你需要通过GetLastError()得到错误是啥。）</p>
<p>代码像下面这样：</p>
<p><pre class="lang:c++ decode:true ">while (bWorking)<br>    {<br>        bWorking = finder.FindNextFile();<br>        if (finder.IsDots())<br>            continue;  //跳过..<br>        CString foldername = (LPCTSTR)finder.GetFileName();  //得到文件名<br>        //MessageBox(foldername);<br>        if (finder.IsDirectory())<br>        {<br>                   //如果是路径<br>        }<br>                else<br>                {<br>                   //如果是文件<br>                 }<br>    }</pre><br>如果是路径呢，大家还可以递归调用FindNextFile知道遍历整个子目录。</p>
<p>以上代码在Visual Studio 2015中编译通过。</p>
<p>参考：<a href="https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile" target="_blank" rel="noopener">MSDN CFileFind类：https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/11/10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/10/" itemprop="url">Python Tkinter的Entry获取值的问题：有时可以获得，有时却无法获得。</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-10T11:47:26+08:00">
                2016-11-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近再写一个数据分析模块，由于命令行界面太难看，所以需要GUI，于是采用了Python自带的<a href="https://wiki.python.org/moin/TkInter/" target="_blank" rel="noopener">Tkinter（官方文档）</a>。界面上的话，还是挺好看的，而且可移植性强。</p>
<p>由于这个模块需要输入，故我们需要一个编辑框，上网查了下，Tkinter中的编辑框叫做Entry。</p>
<p><a href="http://infohost.nmt.edu/tcc/help/pubs/tkinter/web/ttk-Entry.html" target="_blank" rel="noopener">Entry简要说明：http://infohost.nmt.edu/tcc/help/pubs/tkinter/web/ttk-Entry.html</a></p>
<p>现在有了Entry，接下来，我们就是要获取Entry里面的数据了。</p>
<p>简单的在网上查了下，大家可以发现，几乎全都是一个方法：</p>
<p>关联一个StringVar，然后通过这个StringVar来获取/修改值。</p>
<p>如下：</p>
<p><pre class="lang:python decode:true ">def btnclick():<br>    root.update()<br>    word = data.get() #获取Entry的值</pre></p>
<p>data = StringVar(root)<br>Label(root,text=”请输入要分析的词语（仅一个）:”,width=25,height=2).pack()<br>Entry(root,text=”请输入内容”,width=25,textvariable=data).pack(ipadx=4,ipady=4)<br>Button(root, text=”获取edit内容”, width=15,relief=GROOVE,command=btnclick).pack(pady=16,ipadx=8,ipady=8)<br>当时发现居然这么简单，然后赶紧就照着网上的代码做了。做了之后发现，这个代码，有些时候可以正确获得值，有些时候又不能正确获得，StringVar的get返回空字符串。</p>
<p>这个问题，，，简直 -_- ….想在网上查都不知道应该搜索什么。迷醉。</p>
<p>不过在经过我大力的搜索，与排查问题后，还是找到了解决方案，如下：</p>
<p>简单地讲，就是直接调用Entry的get方法，而不是通过与entry关联的StringVar()来获取值。</p>
<p>如下：</p>
<p><pre class="lang:python decode:true ">def btnclick():<br>    root.update()<br>    word = wordentry.get()  #调用Entry的get方法获得数据</pre></p>
<p>Label(root,text=”KCC数据分析模块 - 基本分析套件\n该模块用于显示指定词语的时间频率关系图”,width=35,height=5).pack()<br>Label(root,text=”请输入要分析的词语（仅一个）:”,width=25,height=2).pack()<br>wordentry = Entry(root,text=”请输入内容”,width=25,textvariable=data) #给entry来个名字<br>wordentry.pack(ipadx=4,ipady=4)<br>Button(root, text=”获取edit内容”, width=15,relief=GROOVE,command=btnclick).pack(pady=16,ipadx=8,ipady=8)<br>通过调用Entry的get方法来获取变量，经过测试：这种方法每一次均可正确获得。</p>
<p><a href="http://infohost.nmt.edu/tcc/help/pubs/tkinter/web/index.html" target="_blank" rel="noopener">参考资料：NMT Tkinter教程 http://infohost.nmt.edu/tcc/help/pubs/tkinter/web/index.html</a></p>
<p><a href="http://stackoverflow.com/questions/10727131/why-is-tkinter-entrys-get-function-returning-nothing" target="_blank" rel="noopener">参考2：StackOverFlow</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/11/03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/03/" itemprop="url">MFC 多字节环境下CStdioFile读取中文显示为乱码解决办法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-03T10:25:12+08:00">
                2016-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/" itemprop="url" rel="index">
                    <span itemprop="name">C++ / Visual C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在MFC对话框工程中，如果选择了多字节工程，会导致CStdioFile读取文件内容的时候中文字符显示为乱码。而相同情况下CFile则不存在该问题。</p>
<p>在经过一番搜索后发现可以通过C++的本地化（<a href="https://msdn.microsoft.com/en-us/library/x99tb11d.aspx" target="_blank" rel="noopener">MSDN:setlocale</a>）来解决。方法如下：</p>
<p>在进行文件操作前先执行以下代码修改locale设置为中文：</p>
<p><pre class="lang:c++ decode:true">char* old_locale = _strdup( setlocale(LC_CTYPE,NULL) );<br>setlocale( LC_CTYPE, “chs” );</pre><br>在文件操作完毕后，再执行以下代码恢复locale设置：</p>
<p><pre class="lang:c++ decode:true ">setlocale( LC_CTYPE, old_locale );<br>free( old_locale );</pre><br><strong>注意</strong>，你需要引用以下头文件：</p>
<p><pre class="">locale.h</pre><br>详细请参考<a href="https://msdn.microsoft.com/en-us/library/x99tb11d.aspx" target="_blank" rel="noopener">MSDN：https://msdn.microsoft.com/en-us/library/x99tb11d.aspx</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/10/30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/30/" itemprop="url">MFC自定义消息传递，实现子线程更新主窗口数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-30T11:50:27+08:00">
                2016-10-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/" itemprop="url" rel="index">
                    <span itemprop="name">C++ / Visual C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在写贴吧分布式爬虫项目的客户端，采用了MFC来写。</p>
<p>其中需要后台连接服务器更新在线爬虫列表。这里使用多线程是肯定的，但是如何实现在工作线程里操作主对话框里的数据。</p>
<p>当时想的是在开辟新线程的时候，将主对话框的this指针传递给子线程。</p>
<p>但事实证明，在VS 2015环境下，这种方法并不行，会引发运行时错误（Assertion Failed）。</p>
<p>后面在网上查了一翻关于MFC子线程如何操作主对话框数据的资料，了解到，可以通过<a href="http://blog.csdn.net/npu_wy/article/details/28625085" target="_blank" rel="noopener">在子线程里面传递消息来实现</a>。但是原文里面的方法，在消息映射那里并不行。</p>
<p>后来在MSDN上查了下，终于正确实现子线程传递消息到主对话框，然后，调用相应的函数更新数据。</p>
<p>首先，我们要自定义一个我们要传递的消息，在对话框类的头文件中声明：</p>
<p><pre class="lang:c++ decode:true ">#define WM_MY_MESSAGE WM_USER+100</pre><br>然后，我们要声明对应的消息处理函数，即，触发该消息的时候要调用的函数：</p>
<p><pre class="lang:c++ decode:true">//根据MSDN<br>//函数原型必须如下（对于ON_MESSAGE来说）：<br>afx_msg LRESULT OnMyMessage(WPARAM, LPARAM)<br>{<br>     //在这里添加处理方法<br>}</pre><br>然后，我们当然要实现这个函数，假设读者已经实现了这个函数。</p>
<p>紧接着，我们需要在相应源文件中的消息映射里面添加对应的消息映射，把我们刚刚自定义的消息映射到那个函数去：</p>
<p><pre class="lang:c++ decode:true ">BEGIN_MESSAGE_MAP(CLmsTestDlg, CDialog)<br>……………<br>……………<br>ON_MESSAGE(WM_MY_MESSAGE,OnMyMessage)   //这是我们添加的消息映射<br>//消息映射一定要添加到BEGIN_MESSAGE_MAP和END_MESSAGE_MAP之间<br>END_MESSAGE_MAP()</pre><br>关于为什么用ON_MESSAGE,这个宏是可以处理一切消息的。具体请查阅MSDN</p>
<p>然后，我们在线程函数里面调用PostMessage方法传递消息即可：</p>
<p><pre class="lang:c++ decode:true ">//线程函数<br>UINT myThreadProc(LPRARM lPram)<br>{<br>…….<br>…….<br>WHAND whand = (WHAND)lPram;     //由于PostMessage第一个参数为窗口句柄，所以我们要得到主窗口句柄<br>::PostMessage(whand,WM_MY_MESSAGE,NULL,NULL);  //传递消息</pre></p>
<p>}<br>在线程函数里面，我们需要传递一个主窗口句柄给PostMessage函数，所以，在调用AfxBeginThread的时候，我们需要传递主窗口的句柄给它。可以通过以下方法获取主窗口句柄：</p>
<p><pre class="lang:c++ decode:true ">//在任何位置都可以通过这个方法来取得主窗口句柄<br>AfxGetMainWnd()-&gt;m_hWnd;</pre><br>至此，我们已经成功的实现了在子线程中完成主窗口数据的更新。</p>
<p>&nbsp;</p>
<p>参考：</p>
<p><a href="https://msdn.microsoft.com/zh-cn/library/k35k2bfs.aspx" target="_blank" rel="noopener">MSDN：https://msdn.microsoft.com/zh-cn/library/k35k2bfs.aspx</a></p>
<p><a href="http://blog.csdn.net/npu_wy/article/details/28625085" target="_blank" rel="noopener">CSDN BLOG：http://blog.csdn.net/npu_wy/article/details/28625085</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/10/29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/29/" itemprop="url">JavaScript实现网页滚动到底部自动加载新内容</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-29T14:45:07+08:00">
                2016-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实现效果如图<a href="http://akakanch.com/wp-content/uploads/2016/10/QQ截图20161029143852.png"><img src="http://akakanch.com/wp-content/uploads/2016/10/QQ截图20161029143852.png" alt="QQ截图20161029143852"></a></p>
<p>当网页滚动到底部的时候，自动加载更多评论。</p>
<p>JavaScript的实现逻辑非常简单，就是判断滚动条的滚动长度是否和网页长度一样了。</p>
<p>其JS代码如下：</p>
<p><pre class="lang:js decode:true ">var p = 1;<br>                    var page_num = 2;</pre></p>
<pre><code>function loadComments() {
    var tid = document.getElementById(&quot;tid&quot;).innerHTML;
    var commentsbaseurl = &quot;/getcomments/&quot;
    commentsbaseurl = commentsbaseurl + tid + &quot;/&quot; + p + &quot;/&quot;;
    p += 5
    $.get(commentsbaseurl, function(data) {
        if (data != &quot;NULL&quot;) {
            document.getElementById(&quot;commentslist&quot;).innerHTML = document.getElementById(&quot;commentslist&quot;).innerHTML + data;
        } else {
            $.snackbar({
                content: &quot;评论已经全部拉取完毕！如果你刚刚提交了评论，请不要着急，评论刷新存在延迟。&quot;
            });
        }
    });
}
$(document).ready(function() {
    $(window).scroll(function() {
        if ($(document).scrollTop() &amp;gt;= $(document).height() - $(window).height()) {
            var div1tem = $(&apos;#container&apos;).height()

            loadComments()
        }
    })
})&lt;/pre&gt;
</code></pre><p>你们只需要自定义loadComments(）函数即可实现，当网页滚动到底部的时候加载更多内容。</p>
<p>即通过JavaScript获取新内容放到以个&lt;div&gt;&lt;/div&gt;里即可。</p>
<hr>
<p>已知bug：</p>
<p>如果用户的分辨率太大，浏览器没有滚动条出现，那么此方法就会失效。</p>
<p>一个可能的解决办法是，再加一个按钮，来实现手动加载。</p>
<p>&nbsp;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/10/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/27/" itemprop="url">Windows MFC C++ socket与Linux Python Socket交互接收乱码问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-27T20:33:19+08:00">
                2016-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/" itemprop="url" rel="index">
                    <span itemprop="name">C++ / Visual C++</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C-Visual-C/Linux-Unix-虚拟主机-VPS/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近在写一个爬虫项目，要用到Ubuntu服务器上运行的Python服务器与Windows上的管理端交互。</p>
<p>正常的来说，都是简单的几句socket send/recv实现，编码问题理论上讲应该是不用担心的。</p>
<p>但在Python脚本端的send里面，我编码成了utf-8编码，而windows默认为UNICODE，结果导致了无论是中文还是英文，Python 服务器端接收正常但windows端却一直是乱码。</p>
<p>解决方法主要是利用<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd319072(v=vs.85" target="_blank" rel="noopener">MultiByteToWideChar</a>.aspx)（点击可跳转到MSDN）函数，将UTF-8转换成UNICODE</p>
<p>封装后的函数如下：</p>
<p><pre class="lang:c++ decode:true ">//这段代码在MFC环境中正常<br>wchar_t <em> UTF8ToUnicode( const char</em> str )<br>{<br>      int    textlen = 0;<br>      wchar_t <em> result;<br>      textlen = MultiByteToWideChar( CP_UTF8, 0, str,-1,    NULL,0 );<br>      result = (wchar_t </em>)malloc((textlen+1)<em>sizeof(wchar_t));<br>      memset(result,0,(textlen+1)</em>sizeof(wchar_t));<br>      MultiByteToWideChar(CP_UTF8, 0,str,-1,(LPWSTR)result,textlen );<br>      return    result;<br>}</pre><br>简单的对接收到的数据调用这个函数即可实现正常显示。</p>
<p>同理，下面的函数实现了UNICODE到UTF-8的转换：</p>
<p><pre class="lang:c++ decode:true ">char <em> CKCCDlg::UnicodeToUTF8(const wchar_t </em>str)<br>{<br>    char <em> result;<br>    int textlen = 0;<br>    // wide char to multi char<br>    textlen = WideCharToMultiByte(CP_UTF8, 0, str, -1, NULL, 0, NULL, NULL);<br>    result = (char </em>)malloc((textlen + 1) <em> sizeof(char));<br>    memset(result, 0, sizeof(char) </em> (textlen + 1));<br>    WideCharToMultiByte(CP_UTF8, 0, str, -1, result, textlen, NULL, NULL);<br>    return result;<br>}</pre><br>从此再也不怕C++客户端(服务器)和Python服务器(客户端)交互了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/10/22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/22/" itemprop="url">JavaScript实现HTML Input标签的智能提示框</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-22T23:32:07+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实现智能提示编辑框。</p>
<p>当用户在输入的时候，根据用户输入内容，自动补全可能内容。效果如下图：</p>
<p><a href="http://akakanch.com/wp-content/uploads/2016/10/111.png"><img src="http://akakanch.com/wp-content/uploads/2016/10/111.png" alt="111"></a></p>
<p>主要通过JavaScript来获取服务器更新，然后通过JavaScript向input对应的一个&lt;datalist&gt;&lt;/datalist&gt;添加&lt;options&gt;&lt;/options&gt;元素实现。（需要input响应oninput），input以及对应的datalist代码如下：</p>
<p><pre class="lang:xhtml decode:true ">&lt;input class=”form-control” id=”focusedInput_name” type=”text” onkeydown=”javascript:keydown();” oninput=”javascript:showautofill()” list=”word”&gt;<br>                    &lt;datalist id=”word”&gt;<br>            &lt;!–智能k提示–&gt;<br>            &lt;/datalist&gt;</pre><br>其中，当input接收到输入的时候，会执行showautofill()，其对应代码如下：</p>
<p><pre class="lang:js decode:true ">&lt;script type=”text/javascript”&gt;<br>function showautofill(){<br>    var commentsbaseurl = “/autofill/“<br>                var qord = document.getElementById(‘focusedInput_name’).value;<br>                commentsbaseurl = commentsbaseurl + qord;<br>                $.get(commentsbaseurl, function(data) {<br>                    if (data != “NULL”) {<br>                         document.getElementById(“word”).innerHTML = data;<br>                    }<br>                });<br>}</pre></p>
<p>&lt;/script&gt;<br>在上面代码中，我们通过commentsbaseurl来获取提示数据。</p>
<p>注意，这里的提示数据是由我服务器直接返回的一大串 &lt;options&gt;&lt;/options&gt;数据。然后直接插入到word div标签的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://akakanch.com/2016/10/21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kanch">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="akakanch">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/21/" itemprop="url">Ubuntu14.04 Nginx反向解析Python Flask网站，实现与wordpress共存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-21T14:43:00+08:00">
                2016-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/" itemprop="url" rel="index">
                    <span itemprop="name">Linux / Unix /虚拟主机 / VPS</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
                  . 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-Unix-虚拟主机-VPS/Python/网站制作相关/" itemprop="url" rel="index">
                    <span itemprop="name">网站制作相关</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我最近用Python Flask做了一个我们学校的老师评分系统（成都信息工程大学：<a href="http://trs.akakanch.com/" target="_blank" rel="noopener">http://trs.akakanch.com/</a>），但是问题来了，因为我在这个服务器上托管了Wordpress博客，导致默认的80端口是wordpress，flask网站为5000端口，而且二级域名解析是不认端口的，所以我需要想办法把80端口该为flask网站的流量转发给flask的服务器。</p>
<p>在经过一番搜索后，找到了答案（<a href="http://stackoverflow.com/questions/23649444/redirect-subdomain-to-port-nginx-flask" target="_blank" rel="noopener">http://stackoverflow.com/questions/23649444/redirect-subdomain-to-port-nginx-flask</a>）。通过Nginx的Virtual Server监听80端口，然后把属于flask的流量转发到5000端口。</p>
<p>我们wordpress的域名为：akakanch.com</p>
<p>给flask站点分配deep域名为：trs.akakanch.com</p>
<p>首先我们要打开Nginx的配置文件：</p>
<p><pre class="lang:sh decode:true ">sudo vi /etc/nginx/sites-available/default</pre><br>然后在顶部添加如下配置即可实现：</p>
<p><pre class="lang:sh decode:true ">server {<br>    listen 80;<br>    server_name trs.akakanch.com;</pre></p>
<pre><code>location / {
    proxy_pass http://localhost:5000;
}   
</code></pre><p>}<br>*大家打开文件的时候可能会注意到已经存在server{….}块了，请不要在原有server块上修改。添加新的server块。每一个server块都相当于一个Virtual Server。</p>
<p>这样我们便成功的实现了反向代理flask站点。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Kanch</p>
              <p class="site-description motion-element" itemprop="description">personal blog of Long Zhang (kanchisme@gmail.com)</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">Kategorien</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">282</span>
                  <span class="site-state-item-name">Tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kanch</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
