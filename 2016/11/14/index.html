<html>
    <!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	

	<title>MFC利用CFileFind枚举目录下所有文件 | akakanch</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	<link rel="shortcut icon" href="/favicon.ico">	
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/caomei.css">
	<link rel="stylesheet" href="/css/style.css">
	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

    <body>
        <div class="root">
            <div class='topnavs container fixed-690'>
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            首页
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/categories">
                            分类
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/archives">
                            归档
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/tags">
                            标签
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/about">
                            关于
                        </a>
                    </li>
                    
            </ul>
        </div>
    </nav>
</div>
                <section class="container mainbody fixed-690">
                    <div class="post">
    <div class="post-title">
        <h1>
            MFC利用CFileFind枚举目录下所有文件 
        </h1>

        
        <div class="post-title-views">
            <span id="busuanzi_container_page_pv">
                本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
            </span>
        </div>
        
    </div>
    <div class="post-content markdown">
        <p>最近在写<a href="https://github.com/ankanch/tieba-zhuaqu" target="_blank" rel="noopener">贴吧分布式爬虫系统（https://github.com/ankanch/tieba-zhuaqu）</a>的用户管理端程序。为了保证高度可扩展性，在该程序的数据分析部分，引入了插件机制。这样日后需要拓展功能的时候只需要不断的增加插件（由于插件是python写的，所以我们只需要用C++调用cmd执行python插件就行。如果需要UI，也可以使用python自带的Tkinter实现。）</p>
<p>这样，便通过C++与python结合的方式，完成了用户管理端程序。</p>
<p>该程序所引入的插件机制非常简单，因为插件是用python脚本完成的，所以我们只需要让我们的C++程序找到python脚本，并且执行即可。</p>
<p>这样就涉及到一个问题，那就是如何令MFC程序列举出当前一个子目录下的所有文件。一旦实现这个，我们基本也就完成了插件的加载功能。</p>
<p>还是上网查，查如何解决，在试了一系列的方法后，找到了一个叫做<a href="https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile" target="_blank" rel="noopener">CFileFind类</a>。然后去MSDN查这个类的用法，我们可以发现，MSDN指出：</p>
<p><pre class="">执行本地文件搜索和是 CGopherFileFind 和 CFtpFileFind的基类，执行Internet文件搜索。</pre><br>只有一句话，重点是，它可以执行本地文件搜索，比那些Windows API好用多了。</p>
<p>接下来我们讲讲如何使用这个类，从MSDN查询我们可以发现，我们主要需要以下几个函数：</p>
<p><table summary="table"></table></p>
<p><tbody></tbody></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::Close</td></p>
<p><td data-th="说明">关闭搜索请求。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::FindFile</td></p>
<p><td data-th="说明">搜索一个目录一个指定的文件名。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::FindNextFile</td></p>
<p><td data-th="说明">继续以前的文件搜索调用 FindFile。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称"></td></p>
<p><td data-th="说明"></td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::GetFileName</td></p>
<p><td data-th="说明">获取名称，包括扩展，找到的文件</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::IsDirectory</td></p>
<p><td data-th="说明">确定找到的文件是否为内容。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称">CFileFind::IsDots</td></p>
<p><td data-th="说明">确定找到的文件的名称是否具有名称“”。或者“。”，指示实际上是内容。</td><br></p>
<p><tr></tr></p>
<p><td data-th="名称"></td></p>
<p><td data-th="说明"></td><br><br><br><br><a href="https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile" target="_blank" rel="noopener">（内容来源：MSDN：https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile）</a></p>
<p>那么如何搜索呢？</p>
<p>根据MSDN上的例子，我们在第一次查找的时候，首先需要给其传入一个路径，指明在哪里查找该文件。</p>
<p><pre class="lang:c++ decode:true ">//下面的代码传入当前exe文件同目录下的plugins文件夹路径-&gt;kanch<br>CFileFind finder;<br>BOOL bWorking = finder.FindFile(_T(“.\plugins\<em>.</em>“));</pre><br>然后，我们只需要循环调用FindNextFile()，并判断其返回值是否为false即可。（当为false时，表示已经遍历完当前目录下所有文件，或者出错。如果出错，你需要通过GetLastError()得到错误是啥。）</p>
<p>代码像下面这样：</p>
<p><pre class="lang:c++ decode:true ">while (bWorking)<br>    {<br>        bWorking = finder.FindNextFile();<br>        if (finder.IsDots())<br>            continue;  //跳过..<br>        CString foldername = (LPCTSTR)finder.GetFileName();  //得到文件名<br>        //MessageBox(foldername);<br>        if (finder.IsDirectory())<br>        {<br>                   //如果是路径<br>        }<br>                else<br>                {<br>                   //如果是文件<br>                 }<br>    }</pre><br>如果是路径呢，大家还可以递归调用FindNextFile知道遍历整个子目录。</p>
<p>以上代码在Visual Studio 2015中编译通过。</p>
<p>参考：<a href="https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile" target="_blank" rel="noopener">MSDN CFileFind类：https://msdn.microsoft.com/library/9990068c-b023-4114-9580-a50182d15240.aspx#cfilefind__findfile</a></p>
 
    </div>
    <div class="post-foot">
        <div id="disqus_thread"></div>
    </div>
</div>


                </section>
                <footer class="container fixed-690 footer">
    <div>
        <span>Power by <a href="https://hexo.io">Hexo</a></span>
    </div>
    <div>
        <span>Theme <a href="https://github.com/zhengxiaowai/hexo-theme-lessless">lessless</a></span>
    </div>
        
            
<div>
    <span id="hexiangyutest_container_site_pv">
    PV: <span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv">
    UV: <span id="busuanzi_value_site_uv"></span>
    </span>
</div>

        
</footer>
        </div>
        
<script src="/js/jquery-3.2.1.slim.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


    

    </body>
</html>