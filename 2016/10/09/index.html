<html>
    <!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	

	<title>Android WebView屏蔽网页内的广告 | akakanch</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	<link rel="shortcut icon" href="/favicon.ico">	
	<link rel="stylesheet" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="/css/caomei.css">
	<link rel="stylesheet" href="/css/style.css">
	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</head>

    <body>
        <div class="root">
            <div class='topnavs container fixed-690'>
    <nav class="navbar navbar-expand-lg navbar-light">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            首页
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/categories">
                            分类
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/archives">
                            归档
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/tags">
                            标签
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="/about">
                            关于
                        </a>
                    </li>
                    
            </ul>
        </div>
    </nav>
</div>
                <section class="container mainbody fixed-690">
                    <div class="post">
    <div class="post-title">
        <h1>
            Android WebView屏蔽网页内的广告 
        </h1>

        
        <div class="post-title-views">
            <span id="busuanzi_container_page_pv">
                本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
            </span>
        </div>
        
    </div>
    <div class="post-content markdown">
        <p>最近在做一个新闻聚合应用，类似与RSS。聚合新闻标题，当用户点击后，在应用内（或应用外）打开新闻。</p>
<p>然后，就发现有些站点居然广告掺不忍睹。。。。</p>
<p><a href="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202650.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202650-169x300.png" alt="screenshot_20161009-202650"></a><a href="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202659.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202659-169x300.png" alt="screenshot_20161009-202659"></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>所以，开始研究如何屏蔽广告，这样才可以让应用更加的美观。</p>
<p>在网上查了一番后，发现可以通过注入Java Script代码，来实现对指定元素的过滤（隐藏或者删除，分别讲这两种，接下来）</p>
<h6 id="法1：通过seletor来隐藏标签。"><a href="#法1：通过seletor来隐藏标签。" class="headerlink" title="法1：通过seletor来隐藏标签。"></a>法1：通过seletor来隐藏标签。</h6><p>首先，我们需要获取指定元素的seletor，获取方法如下图（右键新窗口打开，查看大图）：</p>
<p>Chrome浏览器中F12打开开发者工具，然后右键菜单，copy，copy seletor就可以获得一个唯一的seletor</p>
<p><a href="http://115.159.197.66/wp-content/uploads/2016/10/222.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/10/222-1024x576.png" alt="222"></a></p>
<p>获取到seletor后，我们对WebView重写onPageFinished函数，加入以下代码：</p>
<p>下面的代码将Java Script注入到webView中，然后，通过这个seletor去寻找相应的元素，并处理。</p>
<p><pre class="lang:java decode:true ">wv.setWebViewClient(new WebViewClient(){</pre></p>
<pre><code>    @Override
    public void onPageFinished(WebView view, String url) {
            //屏蔽百度嵌入广告
            view.loadUrl(&quot;javascript:function setTop(){document.querySelector(&apos;#BAIDU_SSP__wrapper_u2578965_0&apos;).style.display=\&quot;none\&quot;;}setTop();&quot;);
    }
});&lt;/pre&gt;
</code></pre><p>然后，我们再打开网页，就会发现，在网页加载完成后，广告就会自动去掉。</p>
<h6 id="法2：直接删除标签"><a href="#法2：直接删除标签" class="headerlink" title="法2：直接删除标签"></a>法2：直接删除标签</h6><p>通过以下代码，并传入HTML元素的ID值，即可实现直接删除标签：</p>
<p><pre class="lang:java decode:true ">view.loadUrl(“javascript:var con = document.getElementById(‘gamesliderwrap’); con.parentNode.removeChild(con); “);</pre><br>最后，删除广告后我们的页面，就清爽多了。如下图：</p>
<p><a href="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202817.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202817-169x300.png" alt="screenshot_20161009-202817"></a> <a href="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202822.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-202822-169x300.png" alt="screenshot_20161009-202822"></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h5 id="写在最后："><a href="#写在最后：" class="headerlink" title="写在最后："></a>写在最后：</h5><p>由于上面的方法都是在页面加载完成后再注入Java Script代码，再进行广告屏蔽的。</p>
<p>这样，用户还是会先看到广告，所以，我建议在页面加载完成前，显示另外一个fregment提示正在加载，或者直接隐藏WebView，等到页面加载完成后再显示。如下图：</p>
<p><a href="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-210540.png" target="_blank" rel="noopener"><img src="http://115.159.197.66/wp-content/uploads/2016/10/Screenshot_20161009-210540-169x300.png" alt="screenshot_20161009-210540"></a></p>
<p>也可以在onPageStart中写While循环，来循环执行Java Script注入代码。这样HTML元素一显示，就会被处理掉。</p>
<p>&nbsp;</p>
 
    </div>
    <div class="post-foot">
        <div id="disqus_thread"></div>
    </div>
</div>


                </section>
                <footer class="container fixed-690 footer">
    <div>
        <span>Power by <a href="https://hexo.io">Hexo</a></span>
    </div>
    <div>
        <span>Theme <a href="https://github.com/zhengxiaowai/hexo-theme-lessless">lessless</a></span>
    </div>
        
            
<div>
    <span id="hexiangyutest_container_site_pv">
    PV: <span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv">
    UV: <span id="busuanzi_value_site_uv"></span>
    </span>
</div>

        
</footer>
        </div>
        
<script src="/js/jquery-3.2.1.slim.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


    

    </body>
</html>